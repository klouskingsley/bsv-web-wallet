(this["webpackJsonpbsv-web-wallet"]=this["webpackJsonpbsv-web-wallet"]||[]).push([[0],{104:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Testnet="testnet",e.Mainnet="mainnet",e.STN="STN"}(r||(r={}))},12:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"i",(function(){return i})),n.d(t,"j",(function(){return o})),n.d(t,"h",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return d})),n.d(t,"g",(function(){return b})),n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return p})),n.d(t,"l",(function(){return h})),n.d(t,"a",(function(){return j})),n.d(t,"k",(function(){return v}));var r=n(44),a=n.n(r),s=n(309);function c(e){for(var t=new a.a(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t=t.div(new a.a(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]));return t.toString()}function i(e){for(var t=new a.a(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t=t.multipliedBy(new a.a(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]));return t.toString()}function o(e){for(var t=new a.a(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t=t.plus(new a.a(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]));return t.toString()}function u(e){for(var t=new a.a(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t=t.minus(new a.a(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]));return t.toString()}function l(e){return new a.a(10).pow(e).toString()}function d(e,t){return new a.a(e).lt(new a.a(t))}function b(e,t){return new a.a(e).lte(new a.a(t))}function f(e,t){return new a.a(e).gt(new a.a(t))}function p(e,t){return new a.a(e).gte(new a.a(t))}function h(e){return new a.a(e).toString()}function j(e,t){t=t||.5;var n=e.toBuffer().length,r=e.getFee()/n;if(r<t){var a="The fee rate should not be less than ".concat(t,", but in the end it is ").concat(r);throw s.b.error(a),new Error(a)}}function v(e){return JSON.parse(JSON.stringify(e,(function(e,t){return"bigint"===typeof t?t.toString():t})))}},328:function(e,t){},410:function(e,t){},42:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return O})),n.d(t,"h",(function(){return w})),n.d(t,"b",(function(){return k})),n.d(t,"e",(function(){return y})),n.d(t,"f",(function(){return S})),n.d(t,"g",(function(){return T})),n.d(t,"d",(function(){return I})),n.d(t,"c",(function(){return B})),n.d(t,"k",(function(){return q})),n.d(t,"j",(function(){return M})),n.d(t,"i",(function(){return Y}));var r=n(10),a=n.n(r),s=n(308),c=n(30),i=n(29),o=n(34),u=n(104),l=n(158),d=n.n(l),b=n(303),f=n(149),p=n(224),h=n(99),j=n(12),v=n(64);function x(e){var t=e===u.a.Mainnet?"":"/test";return"https://api.sensiblequery.com".concat(t)}function m(e){return 0===e.code&&"ok"===e.msg}function g(e){return new Promise((function(t){return setTimeout(t,e)}))}function O(e,t){return j.b(e,j.c(t))}function w(e,t){try{return new o.bsv.Address(t,e),!0}catch(n){return!1}}function k(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.a.Testnet,a=t;a+="|"+n+"|",a+=a.length+"|!@"+7*(7*n.length+t.length);var s=n.match(/[a-z]+/g)?n.match(/[a-z]+/g).length:1,c=n.match(/[A-Z]+/g)?n.match(/[A-Z]+/g).length:1,i=n.match(/[0-9]+/g)?n.match(/[0-9]+/g).length:1;a+=(i+s+c)*n.length+"3571",a+=a+""+a;var l=e.from(a);l=o.bsv.crypto.Hash.sha256(l);for(var d=0;d<=49;d++){var b=e.from(l.toString("hex"));l=o.bsv.crypto.Hash.sha256(b)}var f=o.bsv.crypto.Hash.sha256(e.from(l.toString("hex"))).toString("hex"),p=new o.bsv.PrivateKey(f,r),h=p.toAddress(r).toString();return{address:h,privateKey:p.toString(),publicKey:p.toPublicKey().toString()}}function y(e,t,n,r){var a=e===u.a.Mainnet?"":"/test";return"https://sensiblequery.com".concat(a,"/#/ft/utxo/").concat(r,"/").concat(n,"/").concat(t)}function S(e,t){var n="";return e===u.a.Mainnet&&(n="https://whatsonchain.com/address/"),e===u.a.Testnet&&(n="https://test.whatsonchain.com/address/"),n?n+=t:n}function T(e,t){var n="";return e===u.a.Mainnet&&(n="https://whatsonchain.com/tx/"),e===u.a.Testnet&&(n="https://test.whatsonchain.com/tx/"),n?n+=t:n}function I(e,t){return F.apply(this,arguments)}function F(){return(F=Object(i.a)(a.a.mark((function e(t,n){var r,c,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],e.prev=1,c=1;case 3:return e.next=5,C(t,n,c);case 5:if(i=e.sent,r=[].concat(Object(s.a)(r),Object(s.a)(i)),0!==i.length){e.next=9;break}return e.abrupt("break",12);case 9:c++,e.next=3;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.log("getAddressSensibleFtList error"),console.error(e.t0);case 18:return e.abrupt("return",r);case 19:case"end":return e.stop()}}),e,null,[[1,14]])})))).apply(this,arguments)}function C(e,t,n){return A.apply(this,arguments)}function A(){return(A=Object(i.a)(a.a.mark((function e(t,n,r){var s,c,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=x(t),e.next=3,d.a.get("".concat(s,"/ft/summary/").concat(n,"?cursor=").concat(20*(r-1),"&size=20"));case 3:if(c=e.sent,i=c.data,!m(i)){e.next=8;break}return e.abrupt("return",(i.data||[]).map((function(e){return{genesis:e.genesis,codehash:e.codehash,tokenName:e.name,tokenSymbol:e.symbol,tokenDecimal:e.decimal,balance:j.j(e.balance,e.pendingBalance)}})));case 8:throw new Error(i.msg);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,n){return P.apply(this,arguments)}function P(){return(P=Object(i.a)(a.a.mark((function e(t,n,r){var s,c,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 16,s=16*(r-1),c=x(t),e.next=5,d.a.get("".concat(c,"/address/").concat(n,"/utxo?cursor=").concat(s,"&size=").concat(16));case 5:if(i=e.sent,o=i.data,!m(o)){e.next=10;break}return e.abrupt("return",(o.data||[]).map((function(e){return{txId:e.txid,outputIndex:e.vout,satoshis:e.satoshi,address:n}})));case 10:throw new Error(o.msg);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return K.apply(this,arguments)}function K(){return(K=Object(i.a)(a.a.mark((function e(t,n){var r,s,c,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=1,s="0";case 2:return e.next=4,N(t,n,r);case 4:if(c=e.sent,i=c.reduce((function(e,t){return j.j(e,t.satoshis)}),"0"),s=j.j(s,i),0!==c.length){e.next=9;break}return e.abrupt("break",12);case 9:r++;case 10:e.next=2;break;case 12:return console.log("balance",s),e.abrupt("return",s);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return _.apply(this,arguments)}function _(){return(_=Object(i.a)(a.a.mark((function e(t,n){var r,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=x(t),e.next=3,d.a.post("".concat(r,"/pushtx"),{txHex:n});case 3:if(s=e.sent,c=s.data,!m(c)){e.next=8;break}return e.abrupt("return",new o.bsv.Transaction(n).hash);case 8:throw new Error(c.msg);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=function(e){return"Insufficient balance."===e.message?new Error("Low bsv balance to pay miners"):e};function q(e,t,n,r,a,s){return D.apply(this,arguments)}function D(){return(D=Object(i.a)(a.a.mark((function e(t,n,r,s,c,i){var o,u,l,d,f,p,h,v,x,m,O,w,k,y,S,T,I,F,C,A,N,P,B;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.SensibleFT.selectSigners();case 2:return o=e.sent,u=new b.SensibleFT({network:t,purse:r,feeb:.5,signerSelecteds:o.signerSelecteds,signers:o.signers}),console.log("transferSensibleFt",s,t,c,i,n),e.prev=5,e.next=8,u.transfer({senderWif:r,receivers:s,codehash:c,genesis:i});case 8:return l=e.sent,d=l.txid,f=l.tx,j.a(f),p=Y(t,f.serialize(!0)),e.abrupt("return",{txid:d,outputs:p.outputs});case 16:if(e.prev=16,e.t0=e.catch(5),h=E(e.t0),v=h.toString(),x=v.indexOf("The count of utxos should not be more than 3 in transfer")>0,m=v.indexOf("Too many token-utxos")>0,console.log("broadcast sensible ft error "),console.error(h),x||m){e.next=26;break}throw h;case 26:if(!x){e.next=59;break}return e.prev=27,e.next=30,V(t,r);case 30:return e.next=32,g(3e3);case 32:e.next=39;break;case 34:throw e.prev=34,e.t1=e.catch(27),console.log("merge bsv utxo fail"),console.error(e.t1),e.t1;case 39:return e.prev=39,e.next=42,u.transfer({senderWif:r,receivers:s,codehash:c,genesis:i});case 42:return O=e.sent,w=O.txid,k=O.tx,j.a(k),y=Y(t,k.serialize(!0)),e.abrupt("return",{txid:w,outputs:y.outputs});case 50:if(e.prev=50,e.t2=e.catch(39),S=E(e.t2),console.log("ft transfer fail after bsv utxo merge"),console.error(S),T=S.toString(),m=T.indexOf("Too many token-utxos")>0){e.next=59;break}throw S;case 59:if(!m){e.next=92;break}return e.prev=60,e.next=63,u.merge({ownerWif:r,codehash:c,genesis:i});case 63:return I=e.sent,F=I.tx,j.a(F),e.next=68,g(3e3);case 68:e.next=75;break;case 70:throw e.prev=70,e.t3=e.catch(60),console.log("merge ft utxo fail"),console.error(e.t3),e.t3;case 75:return e.prev=75,e.next=78,u.transfer({senderWif:r,receivers:s,codehash:c,genesis:i});case 78:return C=e.sent,A=C.txid,N=C.tx,j.a(N),P=Y(t,N.serialize(!0)),e.abrupt("return",{txid:A,outputs:P.outputs});case 86:throw e.prev=86,e.t4=e.catch(75),B=E(e.t4),console.log("ft transfer fail after ft utxo merge"),console.error(B),B;case 92:case"end":return e.stop()}}),e,null,[[5,16],[27,34],[39,50],[60,70],[75,86]])})))).apply(this,arguments)}var H=o.bsv.crypto.Signature,R=H.SIGHASH_ALL|H.SIGHASH_FORKID;function z(e,t,n,r){var a=new o.bsv.Transaction.Signature({publicKey:e.publicKey,prevTxId:t.inputs[n].prevTxId,outputIndex:t.inputs[n].outputIndex,inputIndex:n,signature:o.bsv.Transaction.Sighash.sign(t,e,r,n,t.inputs[n].output.script,t.inputs[n].output.satoshisBN),sigtype:r});t.inputs[n].setScript(o.bsv.Script.buildPublicKeyHashIn(a.publicKey,a.signature.toDER(),a.sigtype))}function W(e,t,n){var r=!0,a={},s=function(e,t){return"".concat(e,"_").concat(j.l(t))};t.outputs.forEach((function(e){var t=e.script.toAddress(n),r=e.satoshis,c=s(t,r);a[c]=(a[c]||0)+1}));for(var c=0;c<e.length;c++){var i=e[c],o=s(i.address,i.amount);if(!a[o]){r=!1;break}a[o]=a[o]-1}return r}function M(e,t,n){return G.apply(this,arguments)}function G(){return(G=Object(i.a)(a.a.mark((function e(t,n,r){var s,c,i,u,l,d,b,f,p,h,x,m,g;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("arguments",t,n,r),s=new o.bsv.PrivateKey(n,t).toAddress(t),e.next=4,B(t,s);case 4:if(c=e.sent,i=r.reduce((function(e,t){return j.j(e,t.amount)}),"0"),!j.f(c,i)){e.next=8;break}throw new Error("Insufficient_bsv_Balance");case 8:u="0",l=[],(d=new o.bsv.Transaction).feePerKb(500),b=456,f=1;case 14:return e.next=16,N(t,s,f);case 16:p=e.sent,h=0;case 18:if(!(h<p.length)){e.next=28;break}if(x=p[h],u=j.j(u,x.satoshis),l.push(x),d.addInput(new o.bsv.Transaction.Input.PublicKeyHash({output:new o.bsv.Transaction.Output({script:o.bsv.Script.buildPublicKeyHashOut(x.address),satoshis:x.satoshis}),prevTxId:x.txId,outputIndex:x.outputIndex,script:o.bsv.Script.empty()})),!j.g(j.j(i,b),u)){e.next=25;break}return e.abrupt("break",28);case 25:h++,e.next=18;break;case 28:if(!j.g(j.j(i,b),u)){e.next=30;break}return e.abrupt("break",35);case 30:if(!(p.length<=0)){e.next=32;break}return e.abrupt("break",35);case 32:f++,e.next=14;break;case 35:return r.forEach((function(e){d.to(e.address,+e.amount)})),j.d(j.h(u,+i),0)&&d.change(s),j.f(j.h(u,d.getFee(),i),b)&&(d.clearOutputs(),r.forEach((function(e,t){r.length===t+1?d.change(e.address):d.to(e.address,+e.amount)}))),d.inputs.forEach((function(e,t){z(new o.bsv.PrivateKey(n),d,t,R)})),j.a(d),e.next=42,L(t,d.serialize());case 42:return m=e.sent,g=Y(t,d.serialize(!0)),W(r,d,t)||(console.log(j.k({type:"bsvTransferAmountNotSatified",txid:d.hash,receivers:r,outputs:g.outputs})),v.b("bsvTransferAmountNotSatified_".concat(s,"_").concat(d.hash))),e.abrupt("return",{txid:m,outputs:g.outputs,fee:d.getFee()});case 47:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){return J.apply(this,arguments)}function J(){return(J=Object(i.a)(a.a.mark((function e(t,n){var r,s,c,i,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new o.bsv.PrivateKey(n,t).toAddress(t),e.next=3,N(t,r,1);case 3:return s=e.sent,(c=new o.bsv.Transaction).feePerKb(500),s.forEach((function(e){c.addInput(new o.bsv.Transaction.Input.PublicKeyHash({output:new o.bsv.Transaction.Output({script:o.bsv.Script.buildPublicKeyHashOut(e.address),satoshis:e.satoshis}),prevTxId:e.txId,outputIndex:e.outputIndex,script:o.bsv.Script.empty()}))})),c.change(r),c.inputs.forEach((function(e,t){z(new o.bsv.PrivateKey(n),c,t,R)})),j.a(c),e.next=12,L(t,c.serialize());case 12:return i=e.sent,u=Y(t,c.serialize(!0)),e.abrupt("return",{txid:i,outputs:u.outputs});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(e){return 0===p.getFlag(e).compare(p.PROTO_FLAG)},Z=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mainnet",r=U(t);if(!r)return null;var a=f.parseDataPart(t),s=new o.bsv.Address(e.from(a.tokenAddress,"hex"),n).toString(),i=Object(o.toHex)(f.getTokenID(t)),u=Object(h.getCodeHash)(new o.bsv.Script(t));return Object(c.a)(Object(c.a)({},a),{},{genesis:i,codehash:u,tokenAddress:s})};function Y(e,t){var n;try{n=new o.bsv.Transaction(t)}catch(r){return{error:r.message}}return{inputs:n.inputs.map((function(t,n){var a=Z(t.script.toBuffer(),e),s={index:n,prevTxId:t.prevTxId.toString("hex"),outputIndex:t.outputIndex,script:t.script.toString("hex")};try{var i=t.script.toAddress(e);i&&(s.address=i.toString())}catch(r){}return a?a.tokenAmount<=0?s:s=Object(c.a)(Object(c.a)({},s),{},{isFt:!0,ftDetail:{genesis:a.genesis,codehash:a.codehash,address:a.tokenAddress,decimal:a.decimalNum,name:a.tokenName,symbol:a.tokenSymbol}}):s})),outputs:n.outputs.map((function(t,n){var a=Z(t.script.toBuffer(),e),s={index:n,satoshis:t.satoshis,script:t.script.toString("hex")};try{var i=t.script.toAddress(e);i&&(s.address=i.toString())}catch(r){}return a?a.tokenAmount<=0?s:s=Object(c.a)(Object(c.a)({},s),{},{isFt:!0,ftDetail:{genesis:a.genesis,codehash:a.codehash,address:a.tokenAddress,decimal:a.decimalNum,name:a.tokenName,symbol:a.tokenSymbol,amount:a.tokenAmount}}):s})),txid:n.hash}}}).call(this,n(9).Buffer)},480:function(e,t,n){},503:function(e,t){},509:function(e,t){},512:function(e,t){},513:function(e,t){},535:function(e,t){},537:function(e,t){},546:function(e,t){},548:function(e,t){},574:function(e,t){},576:function(e,t){},581:function(e,t){},583:function(e,t){},589:function(e,t){},591:function(e,t){},603:function(e,t){},606:function(e,t){},645:function(e,t){},676:function(e,t){},787:function(e,t,n){},861:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(48),c=n.n(s),i=(n(480),n(30)),o=n(10),u=n.n(o),l=n(29),d=n(24),b=n(189),f=n(874),p=n(129),h=n(873),j=n(872),v=n(870),x=n(868),m=n(159),g=n(84),O=n(869),w=n(309),k=n(875),y=n(871),S=n(876),T=n(877),I=n(471),F=n(878),C=n(470),A=n(454),N=n(42),P=n(235),B=n(458),K={satotxApiPrefix:"https://api.satotx.com",satotxPubKey:"25108ec89eb96b99314619eb5b124f11f00307a833cda48f5ab1865a04d4cfa567095ea4dd47cdf5c7568cd8efa77805197a67943fe965b0a558216011c374aa06a7527b20b0ce9471e399fa752e8c8b72a12527768a9fc7092f1a7057c1a1514b59df4d154df0d5994ff3b386a04d819474efbd99fb10681db58b1bd857f6d5"},L={account:null,key:null,bsvBalance:null,sensibleFtList:[],satotxConfigMap:new Map};L.satotxConfigMap.set("5b3bfa8e7600d701e70551075573ea28fd16c25a39fe2bdafdc3e08b11ca76b800000000",[K,K,K]);var _=Object(B.a)(L),E=_.useGlobalState,q=_.getGlobalState,D=_.setGlobalState,H="accountStorageKey";function R(e){var t=e?JSON.stringify(e):"";localStorage.setItem(H,t)}function z(){var e=localStorage.getItem(H);return e?JSON.parse(e):null}var W=0,M=0;function G(){return V.apply(this,arguments)}function V(){return(V=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearInterval(W),t=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=q("account"),n=q("key"),t&&n){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(N.c)(t.network,n.address);case 7:r=e.sent,D("bsvBalance",{balance:r}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.log("getAddressBsvBalance err",t.network,n.address,e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(){return e.apply(this,arguments)}}(),e.next=4,t();case 4:W=window.setInterval(t,5e3);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return U.apply(this,arguments)}function U(){return(U=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearInterval(M),t=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=q("account"),n=q("key"),t&&n){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(N.d)(t.network,n.address);case 7:r=e.sent,D("sensibleFtList",r),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.log("getAddressSensibleFtList err",t.network,n.address,e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(){return e.apply(this,arguments)}}(),e.next=4,t();case 4:M=window.setInterval(t,5e3);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return Y.apply(this,arguments)}function Y(){return(Y=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R(t),!t){e.next=10;break}return n=Object(N.b)(t.email,t.password,t.network),D("account",t),D("key",n),e.next=7,J();case 7:G(),e.next=12;break;case 10:D("account",null),D("key",null);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function X(){return(X=Object(l.a)(u.a.mark((function e(){var t,n,r,a,s,c,i,o,d,b,f,p,h;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window!==window.top){e.next=2;break}return e.abrupt("return");case 2:t=JSON.parse(decodeURIComponent(window.location.hash.substr(1))),n=P(window.top,"*"),r=t.id,a=null,s=null,c=[],i=null,n.emit(r,{type:"ready"}),o=function(e,t){return!e&&!t||(null===e||void 0===e?void 0:e.balance)===(null===t||void 0===t?void 0:t.balance)},d=function(e,t){if(e.length!==t.length)return!1;e.sort((function(e,t){return e.genesis.localeCompare(t.genesis)})),t.sort((function(e,t){return e.genesis.localeCompare(t.genesis)}));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(r.genesis!==a.genesis)return!1;if(r.balance!==a.balance)return!1}return!0},b=function(e,t){return(null===e||void 0===e?void 0:e.email)===(null===t||void 0===t?void 0:t.email)&&(null===e||void 0===e?void 0:e.network)===(null===t||void 0===t?void 0:t.network)&&(null===e||void 0===e?void 0:e.password)===(null===t||void 0===t?void 0:t.password)},f=function(){var e=Object(l.a)(u.a.mark((function e(){var t,l,f,p,h;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=z(),b(t,a)||n.emit(r,{type:"account",data:t}),!(a=t)){e.next=30;break}return i=Object(N.b)(a.email,a.password,a.network),e.prev=5,e.next=8,Object(N.c)(a.network,i.address);case 8:l=e.sent,f=o(s,{balance:l}),s={balance:l},f||n.emit(r,{type:"bsvBalance",data:s}),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(5);case 16:return e.prev=16,e.next=19,Object(N.d)(a.network,i.address);case 19:p=e.sent,h=d(c,p),c=p,h||n.emit(r,{type:"sensibleFtBalance",data:c}),e.next=27;break;case 25:e.prev=25,e.t1=e.catch(16);case 27:return e.abrupt("return",!0);case 30:return e.abrupt("return",!1);case 31:case"end":return e.stop()}}),e,null,[[5,14],[16,25]])})));return function(){return e.apply(this,arguments)}}(),(p=function(e,t){n.on(r,function(){var a=Object(l.a)(u.a.mark((function a(s,c){var i,o,l,d;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=c.type,o=c.data,"request"!==i||(null===o||void 0===o?void 0:o.method)!==e){a.next=13;break}return l=o.requestId,a.prev=3,a.next=6,t(o.params);case 6:d=a.sent,n.emit(r,{type:"response",data:{requestId:l,method:e,response:d}}),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(3),n.emit(r,{type:"response",data:{requestId:l,method:e,error:a.t0.toString()}});case 13:case"end":return a.stop()}}),a,null,[[3,10]])})));return function(e,t){return a.apply(this,arguments)}}())})("getAccount",Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:if(a){e.next=4;break}return e.abrupt("return",null);case 4:return e.abrupt("return",{name:a.email,email:a.email,network:a.network});case 5:case"end":return e.stop()}}),e)})))),p("getBsvBalance",Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return e.abrupt("return",s);case 3:case"end":return e.stop()}}),e)})))),p("getSensibleFtBalance",Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return e.abrupt("return",c);case 3:case"end":return e.stop()}}),e)})))),p("getAddress",Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:if(i){e.next=4;break}return e.abrupt("return",null);case 4:return e.abrupt("return",i.address);case 5:case"end":return e.stop()}}),e)})))),p("logout",Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R(null);case 1:case"end":return e.stop()}}),e)})))),p("ping",(function(){return null}));case 21:return e.next=23,f();case 23:return h=e.sent,e.next=26,Q(h?3e3:500);case 26:e.next=21;break;case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(r.useRef)(!1);Object(r.useEffect)((function(){t&&!n.current&&(n.current=!0,e())}),[e,t])}n(787);var ee=n(12),te=n(64),ne=n(7),re=b.a.Option;function ae(){var e=E("account"),t=Object(d.a)(e,1)[0],n=E("key"),a=Object(d.a)(n,1)[0],s=Object(r.useState)(!1),c=Object(d.a)(s,2),i=c[0],o=c[1],u=Object(r.useState)(""),l=Object(d.a)(u,2),v=l[0],x=l[1],m=Object(r.useState)(""),g=Object(d.a)(m,2),O=g[0],w=g[1],k=Object(r.useState)(!1),y=Object(d.a)(k,2),S=y[0],T=y[1];return Object(ne.jsxs)("div",{className:"header",children:[Object(ne.jsx)("div",{className:"logo",children:"Web Wallet"}),t&&Object(ne.jsx)(f.a,{title:"",content:Object(ne.jsxs)(ne.Fragment,{children:[Object(ne.jsx)(p.a,{type:"link",onClick:function(){Z(null)},children:"Logout"}),Object(ne.jsx)("br",{}),Object(ne.jsx)(p.a,{type:"link",onClick:function(){var e=Object(N.f)(t.network,a.address);window.open(e)},children:"History"}),Object(ne.jsx)("br",{}),Object(ne.jsx)(p.a,{type:"link",onClick:function(){window.open("http://github.com")},children:"Source Code"}),Object(ne.jsx)("br",{}),Object(ne.jsx)(p.a,{type:"link",onClick:function(){return o(!0)},children:"decode rawtx"})]}),children:Object(ne.jsx)(p.a,{type:"link",children:t.email})}),Object(ne.jsxs)(h.a,{visible:i,onCancel:function(){return o(!1)},children:[Object(ne.jsx)(j.a.TextArea,{rows:4,value:v,onChange:function(e){return x(e.target.value)}}),Object(ne.jsxs)(b.a,{style:{width:180},placeholder:"Select network",value:O,onChange:function(e){return w(e)},children:[Object(ne.jsx)(re,{value:"mainnet",children:"mainnet"}),Object(ne.jsx)(re,{value:"testnet",children:"testnet"})]}),Object(ne.jsx)(p.a,{type:"primary",onClick:function(){var e=Object(N.i)(O,v);console.log("decodeTx res",e)},children:"decode"})]}),Object(ne.jsx)(h.a,{visible:S,onCancel:function(){return T(!1)}})]})}function se(){var e=E("account"),t=Object(d.a)(e,1)[0],n=v.a.useForm(),r=Object(d.a)(n,1)[0];return t?null:Object(ne.jsx)(x.a,{className:"card",title:"Login",bordered:!1,children:Object(ne.jsxs)(v.a,{form:r,layout:"vertical",onFinish:function(){h.a.confirm({title:"\u5b89\u5168\u6ce8\u610f",content:Object(ne.jsxs)("div",{children:["Web\u94b1\u5305\u7684\u79c1\u94a5\u662f\u901a\u8fc7\u7528\u6237\u7684\u90ae\u7bb1\u548c\u5bc6\u7801\u5b9e\u65f6\u8ba1\u7b97\u5f97\u5230\uff0c\u4e0d\u4f1a\u4e0a\u4f20\u670d\u52a1\u5668\uff0c\u4e5f\u4e0d\u4f1a\u4fdd\u5b58\u5728\u672c\u5730(\u4ee3\u7801\u89c1",Object(ne.jsx)("a",{href:"https://github.com/klouskingsley/bsv-web-wallet",target:"_blank",rel:"noreferrer",children:"github"}),")\u3002\u4ec5\u4f9b\u65b9\u4fbf\u7528\u6237\u6d4b\u8bd5\u4e4b\u7528\uff0c\u4e0d\u9002\u5408\u5b58\u653e\u5927\u91cf\u8d44\u91d1\uff0c\u5efa\u8bae\u7528\u6237\u59a5\u5584\u4fdd\u7ba1\u90ae\u7bb1+\u5bc6\u7801\u7ec4\u5408\u4ee5\u9632\u8d44\u91d1\u4e22\u5931\uff0c\u6216\u5728\u4f7f\u7528\u5b8c\u6210\u4e4b\u540e\u5c06\u5269\u4f59\u8d44\u91d1\u8f6c\u79fb\u3002\u90ae\u7bb1+\u5bc6\u7801\u7ec4\u5408\u4e22\u5931(\u5fd8\u8bb0\uff0c\u88ab\u76d7\u7b49\u60c5\u5f62)\u4f1a\u5bfc\u81f4\u8d44\u4ea7\u4e22\u5931"]}),onOk:function(){Z(r.getFieldsValue())}})},children:[Object(ne.jsx)(v.a.Item,{name:"email",rules:[{type:"email",required:!0,message:"Please input a valid Email!"}],children:Object(ne.jsx)(j.a,{prefix:Object(ne.jsx)(S.a,{className:"site-form-item-icon"}),placeholder:"Email"})}),Object(ne.jsx)(v.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"},{min:6,message:"Password at least 6 chars",transform:function(e){return e&&e.trim()}}],children:Object(ne.jsx)(j.a.Password,{prefix:Object(ne.jsx)(T.a,{className:"site-form-item-icon"}),type:"password",visibilityToggle:!0,placeholder:"Password"})}),Object(ne.jsx)(v.a.Item,{name:"network",label:"Network",rules:[{required:!0}],children:Object(ne.jsxs)(b.a,{placeholder:"Select network",children:[Object(ne.jsx)(re,{value:"mainnet",children:"mainnet"}),Object(ne.jsx)(re,{value:"testnet",children:"testnet"})]})}),Object(ne.jsx)(v.a.Item,{children:"\u8bf4\u660e\uff1aWeb\u94b1\u5305\u7684\u79c1\u94a5\u662f\u901a\u8fc7\u7528\u6237\u7684\u90ae\u7bb1\u548c\u5bc6\u7801\u5b9e\u65f6\u8ba1\u7b97\u5f97\u5230(\u65e0\u9700\u6ce8\u518c)\uff0c\u6bcf\u6b21\u8f93\u5165\u76f8\u540c\u7684\u90ae\u7bb1\u548c\u5bc6\u7801\u767b\u5f55\u5373\u53ef\u8ba1\u7b97\u51fa\u76f8\u540c\u7684\u79c1\u94a5\uff0c\u79c1\u94a5\u4e0d\u4f1a\u4e0a\u4f20\u670d\u52a1\u5668\uff0c\u4e5f\u4e0d\u4f1a\u4fdd\u5b58\u5728\u672c\u5730\uff0c\u4ec5\u4f9b\u65b9\u4fbf\u7528\u6237\u6d4b\u8bd5\u4e4b\u7528\uff0c\u4e0d\u9002\u5408\u5b58\u653e\u5927\u91cf\u8d44\u91d1\uff0c\u5efa\u8bae\u7528\u6237\u59a5\u5584\u4fdd\u7ba1\u90ae\u7bb1+\u5bc6\u7801\u7ec4\u5408\u4ee5\u9632\u8d44\u91d1\u4e22\u5931\u3002"}),Object(ne.jsx)(v.a.Item,{children:Object(ne.jsx)(p.a,{type:"primary",htmlType:"submit",className:"login-form-button",children:"Log in"})})]})})}function ce(e){var t=e.onWithDraw,n=e.onTransfer,r=E("key"),a=Object(d.a)(r,1)[0],s=E("account"),c=Object(d.a)(s,1)[0],i=E("bsvBalance"),o=Object(d.a)(i,1)[0],u=E("sensibleFtList"),l=Object(d.a)(u,1)[0];if(!a||!c)return null;var b=function(e){return n(e||"")};return[Object(ne.jsx)(x.a,{className:"card",title:"Account Info",bordered:!1,actions:Object(ne.jsxs)(ne.Fragment,{children:[Object(ne.jsx)(p.a,{type:"link",onClick:function(){var e=Object(N.f)(c.network,a.address);window.open(e)},children:"history"}),",",Object(ne.jsx)(p.a,{type:"link",onClick:t,children:"withdraw"}),","]}),children:Object(ne.jsxs)(v.a,{layout:"vertical",children:[Object(ne.jsxs)(v.a.Item,{label:"".concat(c.network," address"),children:[Object(ne.jsx)(j.a,{value:a.address}),Object(ne.jsx)("div",{style:{margin:20},children:Object(ne.jsx)(A,{value:a.address})})]}),Object(ne.jsx)(v.a.Item,{label:"privateKey",children:Object(ne.jsx)(j.a.Password,{visibilityToggle:!0,value:a.privateKey})})]})}),Object(ne.jsx)(x.a,{className:"card",title:"Asset",bordered:!1,children:Object(ne.jsxs)(v.a,{layout:"vertical",children:[o&&Object(ne.jsx)(v.a.Item,{label:"BSV balance",children:Object(ne.jsxs)(m.a,{justify:"space-between",children:[Object(ne.jsx)(g.a,{span:16,children:Object(ne.jsx)("div",{children:Object(N.a)(o.balance,8)})}),Object(ne.jsx)(g.a,{span:7,children:Object(ne.jsx)(p.a,{type:"link",onClick:function(){return b("")},children:"Transfer BSV"})})]})}),l.length>0&&Object(ne.jsx)(v.a.Item,{label:"Sensible Fungible Token",children:Object(ne.jsx)(O.b,{itemLayout:"horizontal",dataSource:l,renderItem:function(e){return Object(ne.jsxs)(O.b.Item,{actions:Object(ne.jsx)(ne.Fragment,{children:Object(ne.jsx)(f.a,{placement:"topRight",content:Object(ne.jsxs)(ne.Fragment,{children:[Object(ne.jsxs)("div",{children:["codehash: ",e.codehash]}),",",Object(ne.jsxs)("div",{children:["genesis: ",e.genesis]}),","]}),children:Object(ne.jsx)("a",{href:Object(N.e)(c.network,a.address,e.genesis,e.codehash),rel:"noreferrer",target:"_blank",children:"more info"},"list-loadmore-more")})}),children:[Object(ne.jsx)(O.b.Item.Meta,{title:e.tokenSymbol,description:e.tokenName}),Object(ne.jsxs)(m.a,{children:[Object(ne.jsx)(g.a,{children:Object(ne.jsxs)("div",{style:{height:"100%",display:"flex",alignItems:"center"},children:["Balance:"," ",Object(N.a)(e.balance,e.tokenDecimal)]})}),Object(ne.jsx)(g.a,{children:Object(ne.jsx)(p.a,{type:"link",onClick:function(){return b(e.genesis)},children:"Go Transfer"})})]})]},e.genesis)}})})]})})]}function ie(e){var t=e.initDatas,n=void 0===t?[]:t,a=e.onCancel,s=e.onTransferCallback,c=E("key"),o=Object(d.a)(c,1)[0],b=E("bsvBalance"),f=Object(d.a)(b,1)[0],O=E("account"),S=Object(d.a)(O,1)[0],T=E("sensibleFtList"),A=Object(d.a)(T,1)[0],P=E("satotxConfigMap"),B=Object(d.a)(P,1)[0],L=v.a.useForm(),_=Object(d.a)(L,1)[0],q=Object(r.useState)(!1),D=Object(d.a)(q,2),H=D[0],R=D[1];if($((function(){var e={};n.forEach((function(t,n){var r=!t.genesis,a=A.find((function(e){return e.genesis===t.genesis})),s=r?8:a.tokenDecimal;e["receiverList".concat(n)]=t.receivers.map((function(e){return{address:e.address,amount:ee.b(e.amount,ee.c(s))}}))})),_.setFieldsValue(e)}),o&&f),!o)return null;if(!f)return null;var z=function(){var e=Object(l.a)(u.a.mark((function e(){var t,r,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_.getFieldsValue(),r=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.formatReceiverList,R(!0),a="",e.prev=3,e.next=6,Object(N.j)(S.network,o.privateKey,n);case 6:c=e.sent,r=c,a=c.txid,e.next=20;break;case 11:e.prev=11,e.t0=e.catch(3),i="broadcast error: "+e.t0.toString(),te.a(e.t0),te.b("bsvTransferFail_".concat(o.address)),s({error:i}),console.log("broadcast bsv error "),console.error(e.t0),w.b.error(e.t0.toString());case 20:return te.b("bsvTransferSuccess_".concat(o.address,"_").concat(a)),e.abrupt("return",r);case 22:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),a=function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,c,i,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.formatReceiverList,r=t.token,t.decimal,a=t.genesis,R(!0),e.prev=2,i=B.get(a)||[K,K,K],e.next=6,Object(N.k)(S.network,i,o.privateKey,n,r.codehash,r.genesis);case 6:l=e.sent,c=l,e.next=18;break;case 10:e.prev=10,e.t0=e.catch(2),te.a(e.t0),te.b("ftTransferFail_".concat(o.address,"_").concat(r.genesis,"_").concat(r.genesis)),s({error:"broadcast sensible ft error, "+e.t0.toString()}),console.log("broadcast sensible ft error "),console.error(e.t0),w.b.error(e.t0.toString());case 18:return e.abrupt("return",c);case 19:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=Object(l.a)(u.a.mark((function e(){var c,o,l,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=[],o=u.a.mark((function e(i){var o,l,d,b,p,h,j,v,x,m;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n[i],l=!o.genesis,d=A.find((function(e){return e.genesis===o.genesis})),b=l?8:d.tokenDecimal,p=l?f.balance:d.balance,h=t["receiverList".concat(i)].reduce((function(e,t){return ee.j(e,t.amount)}),0),j=ee.i(h,ee.c(b)),!ee.f(p,j)){e.next=11;break}return s({error:v="Insufficient ft balance"}),e.abrupt("return",{v:w.b.error(v)});case 11:if(x=o.receivers.map((function(e){return{address:e.address,amount:e.amount}})),!l){e.next=18;break}return e.next=15,r({formatReceiverList:x});case 15:e.t0=e.sent,e.next=21;break;case 18:return e.next=20,a({formatReceiverList:x,token:d,decimal:b,genesis:o.genesis});case 20:e.t0=e.sent;case 21:m=e.t0,c.push(m);case 23:case"end":return e.stop()}}),e)})),l=0;case 3:if(!(l<n.length)){e.next=11;break}return e.delegateYield(o(l),"t0",5);case 5:if("object"!==typeof(d=e.t0)){e.next=8;break}return e.abrupt("return",d.v);case 8:l++,e.next=3;break;case 11:R(!1),s({response:Object(i.a)({},c)});case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h.a.confirm({title:"Confirm the transaction",onOk:function(){c()}});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(ne.jsx)(x.a,{className:"card",title:Object(ne.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){a()},children:[Object(ne.jsx)(I.a,{}),"Transfer"]}),loading:H,bordered:!1,children:Object(ne.jsxs)(v.a,{form:_,layout:"vertical",onFinish:z,children:[n.map((function(e,t){var n=!e.genesis,r=A.find((function(t){return t.genesis===e.genesis}));if(!n&&!r)return null;var a=n?"BSV":r.tokenSymbol,s=n?8:r.tokenDecimal,c=n?f.balance:r.balance,u=Object(N.a)(c,s),l=!(e.receivers.length>0);return Object(ne.jsxs)("div",{children:[Object(ne.jsx)("div",{className:"transfer-line",children:n?"Coin: ".concat(a):"Token: ".concat(a)}),!n&&Object(ne.jsxs)("div",{className:"transfer-line",children:["Genesis: ",r.genesis]}),!n&&Object(ne.jsxs)("div",{className:"transfer-line",children:["Codehash: ",r.codehash]}),Object(ne.jsx)(m.a,{justify:"space-between",style:{margin:"10px 0"},children:Object(ne.jsx)(g.a,{span:14,children:Object(ne.jsx)("div",{style:{fontWeight:700},children:"Input"})})}),Object(ne.jsx)("div",{className:"transfer-line",children:"Balance: ".concat(u)}),Object(ne.jsx)("div",{className:"transfer-line",children:"From Address: ".concat(o.address)}),Object(ne.jsx)(m.a,{justify:"space-between",style:{margin:"10px 0"},children:Object(ne.jsx)(g.a,{span:14,children:Object(ne.jsx)("div",{style:{fontWeight:700},children:"Output"})})}),Object(ne.jsx)(v.a.List,{name:"receiverList".concat(t),children:function(e,t){var n=t.add,r=t.remove;return Object(ne.jsxs)(ne.Fragment,{children:[e.map((function(e,t,n){for(var a=arguments.length,s=new Array(a>3?a-3:0),c=3;c<a;c++)s[c-3]=arguments[c];return Object(ne.jsxs)(k.b,{style:{display:"flex",marginBottom:8},align:"baseline",children:[Object(ne.jsx)(v.a.Item,Object(i.a)(Object(i.a)({},s),{},{name:[t,"address"],fieldKey:[n,"address"],rules:[{required:!0,message:"Please input the address"},{message:"invalid address",validator:function(e,t){return Object(N.h)(S.network,t)?Promise.resolve():Promise.reject()}}],children:Object(ne.jsx)(j.a,{placeholder:"Input the address",disabled:!l})})),Object(ne.jsx)(v.a.Item,Object(i.a)(Object(i.a)({},s),{},{name:[t,"amount"],fieldKey:[n,"amount"],rules:[{required:!0,message:"Please input amount"}],children:Object(ne.jsx)(y.a,{placeholder:"Amount",min:0,disabled:!l})})),Object(ne.jsx)(p.a,{disabled:!l,size:"small",onClick:function(){return r(t)},shape:"circle",icon:Object(ne.jsx)(F.a,{})})]},e.fieldKey)})),Object(ne.jsx)(v.a.Item,{children:Object(ne.jsx)(p.a,{type:"dashed",onClick:function(){return n()},icon:Object(ne.jsx)(C.a,{}),disabled:!l,children:"Add Output"})})]})}})]},t)})),Object(ne.jsx)(v.a.Item,{children:Object(ne.jsx)(p.a,{type:"primary",htmlType:"submit",block:!0,children:"Transfer"})})]})})}function oe(e){var t=e.genesis,n=void 0===t?"":t,a=e.initReceivers,s=void 0===a?[]:a,c=(e.rabinApis,e.onCancel),o=e.onTransferCallback,b=E("key"),f=Object(d.a)(b,1)[0],O=E("bsvBalance"),S=Object(d.a)(O,1)[0],T=E("account"),A=Object(d.a)(T,1)[0],P=E("sensibleFtList"),B=Object(d.a)(P,1)[0],L=E("satotxConfigMap"),_=Object(d.a)(L,1)[0],q=v.a.useForm(),D=Object(d.a)(q,1)[0],H=Object(r.useState)(!1),R=Object(d.a)(H,2),z=R[0],W=R[1],M=!(s.length>0);if($((function(){var e=""===n,t=B.find((function(e){return e.genesis===n})),r=e?8:t.tokenDecimal;console.log("initReceivers",s,s.map((function(e){return{address:e.address,amount:ee.i(e.amount,ee.c(r))}}))),D.setFieldsValue({receiverList:s.map((function(e){return{address:e.address,amount:ee.b(e.amount,ee.c(r))}}))})}),f&&S&&s.length),!f)return null;if(!S)return null;if(n&&!B.length)return null;var G=""===n,V=B.find((function(e){return e.genesis===n}));if(!G&&!V)return null;var J=G?"BSV":V.tokenSymbol,U=G?8:V.tokenDecimal,Z=G?S.balance:V.balance,Y=Object(N.a)(Z,U),Q=function(){var e=Object(l.a)(u.a.mark((function e(){var t,r,a,s,c,d,b,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=D.getFieldsValue(),r=t.receiverList,a=r.reduce((function(e,t){return ee.j(e,t.amount)}),0),s=ee.i(a,ee.c(U)),!ee.f(Z,s)){e.next=7;break}return o({error:c="Insufficient ft balance"}),e.abrupt("return",w.b.error(c));case 7:d=r.map((function(e){return{address:e.address,amount:ee.i(e.amount,ee.c(U))}})),b=function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W(!0),t="",e.prev=2,e.next=5,Object(N.j)(A.network,f.privateKey,d);case 5:r=e.sent,n=r,t=r.txid,e.next=20;break;case 10:e.prev=10,e.t0=e.catch(2),a="broadcast error: "+e.t0.toString(),console.log(ee.k({type:"bsvTransferFail",msg:a,account:{network:A.network,address:f.address},receivers:d})),te.a(e.t0),te.b("bsvTransferFail_".concat(f.address)),o({error:a}),console.log("broadcast bsv error "),console.error(e.t0),w.b.error(e.t0.toString());case 20:W(!1),t&&(console.log(ee.k(Object(i.a)({type:"bsvTransferSuccess",account:{network:A.network,address:f.address},receivers:d,txid:t},n))),te.b("bsvTransferSuccess_".concat(f.address,"_").concat(t)),o({response:Object(i.a)({},n)}),h.a.success({title:"Transaction broadcast success",content:Object(ne.jsxs)("div",{children:["txid:"," ",Object(ne.jsx)("a",{target:"_blank",rel:"noreferrer",href:Object(N.g)(A.network,t),children:t})]})}));case 22:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(l.a)(u.a.mark((function e(){var t,r,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W(!0),t="",e.prev=2,a=_.get(n)||[K,K,K],e.next=6,Object(N.k)(A.network,a,f.privateKey,d,V.codehash,V.genesis);case 6:s=e.sent,r=s,t=s.txid,e.next=20;break;case 11:e.prev=11,e.t0=e.catch(2),console.log("broadcast sensible ft error "),console.error(e.t0),w.b.error(e.t0.toString()),console.log(ee.k({type:"ftTransferFail",msg:ee.k(e.t0.message),account:{network:A.network,address:f.address},genesis:V.genesis,codehash:V.codehash,receivers:d})),te.a(e.t0),te.b("ftTransferFail_".concat(f.address,"_").concat(V.genesis,"_").concat(V.genesis)),o({error:e.t0.toString()});case 20:W(!1),t&&(console.log(ee.k(Object(i.a)({type:"ftTransferSuccess,",account:{network:A.network,address:f.address,genesis:V.genesis,codehash:V.codehash},receivers:d,txid:t},r))),te.b("ftTransferSuccess_".concat(f.address,"_").concat(t)),o({response:Object(i.a)({},r)}),h.a.success({title:"Transaction broadcast success",content:Object(ne.jsxs)("div",{children:["txid:"," ",Object(ne.jsx)("a",{target:"_blank",rel:"noreferrer",href:Object(N.g)(A.network,t),children:t})]})}));case 22:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}(),h.a.confirm({title:"Confirm the transaction",onOk:function(){G?b():p()}});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(ne.jsx)(x.a,{className:"card",title:Object(ne.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){c()},children:[Object(ne.jsx)(I.a,{}),"Transfer"]}),loading:z,bordered:!1,children:Object(ne.jsxs)(v.a,{form:D,layout:"vertical",onFinish:Q,children:[Object(ne.jsx)("div",{className:"transfer-line",children:G?"Coin: ".concat(J):"Token: ".concat(J)}),!G&&Object(ne.jsxs)("div",{className:"transfer-line",children:["Genesis: ",V.genesis]}),!G&&Object(ne.jsxs)("div",{className:"transfer-line",children:["Codehash: ",V.codehash]}),Object(ne.jsx)(m.a,{justify:"space-between",style:{margin:"10px 0"},children:Object(ne.jsx)(g.a,{span:14,children:Object(ne.jsx)("div",{style:{fontWeight:700},children:"Input"})})}),Object(ne.jsx)("div",{className:"transfer-line",children:"Balance: ".concat(Y)}),Object(ne.jsx)("div",{className:"transfer-line",children:"From Address: ".concat(f.address)}),Object(ne.jsx)(m.a,{justify:"space-between",style:{margin:"10px 0"},children:Object(ne.jsx)(g.a,{span:14,children:Object(ne.jsx)("div",{style:{fontWeight:700},children:"Output"})})}),Object(ne.jsx)(v.a.List,{name:"receiverList",children:function(e,t){var n=t.add,r=t.remove;return Object(ne.jsxs)(ne.Fragment,{children:[e.map((function(e,t,n){for(var a=arguments.length,s=new Array(a>3?a-3:0),c=3;c<a;c++)s[c-3]=arguments[c];return Object(ne.jsxs)(k.b,{style:{display:"flex",marginBottom:8},align:"baseline",children:[Object(ne.jsx)(v.a.Item,Object(i.a)(Object(i.a)({},s),{},{name:[t,"address"],fieldKey:[n,"address"],rules:[{required:!0,message:"Please input the address"},{message:"invalid address",validator:function(e,t){return Object(N.h)(A.network,t)?Promise.resolve():Promise.reject()}}],children:Object(ne.jsx)(j.a,{placeholder:"Input the address",disabled:!M})})),Object(ne.jsx)(v.a.Item,Object(i.a)(Object(i.a)({},s),{},{name:[t,"amount"],fieldKey:[n,"amount"],rules:[{required:!0,message:"Please input amount"}],children:Object(ne.jsx)(y.a,{placeholder:"Amount",min:0,disabled:!M})})),Object(ne.jsx)(p.a,{disabled:!M,size:"small",onClick:function(){return r(t)},shape:"circle",icon:Object(ne.jsx)(F.a,{})})]},e.fieldKey)})),Object(ne.jsx)(v.a.Item,{children:Object(ne.jsx)(p.a,{type:"dashed",onClick:function(){return n()},icon:Object(ne.jsx)(C.a,{}),disabled:!M,children:"Add Output"})})]})}}),Object(ne.jsx)(v.a.Item,{children:Object(ne.jsx)(p.a,{type:"primary",htmlType:"submit",block:!0,children:"Transfer"})})]})})}var ue=function(){Object(r.useEffect)((function(){Z(z())}),[]);var e=Object(r.useState)(!1),t=Object(d.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(""),c=Object(d.a)(s,2),o=c[0],u=c[1],l=E("account"),b=Object(d.a)(l,1)[0],f=E("key"),p=Object(d.a)(f,1)[0],j=E("bsvBalance"),v=Object(d.a)(j,1)[0],x=E("sensibleFtList"),m=Object(d.a)(x,1)[0],g=Object(r.useState)([]),O=Object(d.a)(g,2),w=O[0],k=O[1],y=Object(r.useState)([]),S=Object(d.a)(y,2),T=S[0],I=S[1],F=Object(r.useState)([]),C=Object(d.a)(F,2),A=C[0],N=C[1],B=function(){a(!1),u("")},K=function(){if(!window.opener)return null;var e=window.location.hash.substr(1);try{var t=JSON.parse(decodeURIComponent(e));if("popup"===t.type&&"object"===typeof t.data)return t}catch(n){}return null},L=function(e){var t=K();t&&P(window.opener,"*").emit(t.id,{type:"response",data:Object(i.a)(Object(i.a)({},t.data.data),e)})},_=(null===p||void 0===p?void 0:p.address)&&(null===b||void 0===b?void 0:b.network),q=_&&v&&ee.e(v.balance,0);return $((function(){var e=K();if(e&&"request"===e.data.type){var t=e.data.data,n=t.method,r=t.params;"requestAccount"===n&&h.a.confirm({title:"Connect",content:Object(ne.jsxs)("div",{children:["Allow ",Object(ne.jsx)("b",{children:r.name})," to connect your web wallet"]}),onOk:function(){L({response:!0})},onCancel:function(){L({error:"user reject"})}})}}),!!_),$((function(){var e=K();if(console.log("bsv hash data",e),e&&"request"===e.data.type){var t=e.data.data,n=t.method,r=t.params;if("transferBsv"===n){var s=r.receivers.reduce((function(e,t){return ee.j(e,t.amount)}),0);ee.d(s,v.balance)?L({error:"insufficient bsv balance"}):(a(!0),k(r.receivers))}}}),!!q),$((function(){var e=K();if(console.log("hashdata",e),e&&"request"===e.data.type){var t=e.data.data,n=t.method,r=t.params;if("transferSensibleFt"===n){var s=r.receivers.reduce((function(e,t){return ee.j(e,t.amount)}),0);console.log("outputTotal",s);var c=m.find((function(e){return e.genesis===r.genesis}));console.log("ft",c),c?ee.d(s,c.balance)?L({error:"insufficient ft balance"}):(a(!0),u(r.genesis),k(r.receivers),N(r.rabinApis)):L({error:"insufficient ft balance"})}}}),!!q),$((function(){var e=K();if(console.log("bsv hash data",e),e&&"request"===e.data.type){var t=e.data.data,n=t.method,r=t.params;"transferAll"===n&&r.datas.forEach((function(e){var t=!e.genesis,n=m.find((function(t){return t.genesis===e.genesis})),s=e.receivers.reduce((function(e,t){return ee.j(e,t.amount)}),0);t&&ee.d(s,v.balance)?L({error:"insufficient bsv balance"}):n&&ee.d(s,n.balance)?L({error:"insufficient ft balance"}):(a(!0),I(r.datas))}))}}),!!q),Object(r.useEffect)((function(){var e=window.onbeforeunload;window.onbeforeunload=function(t){return L({error:"use closed"}),e&&e(t)}})),Object(ne.jsxs)("div",{className:"App",style:{overflow:"hidden"},children:[Object(ne.jsx)(ae,{accountName:"harry"}),Object(ne.jsx)(se,{}),!n&&Object(ne.jsx)(ce,{onTransfer:function(e){a(!0),e&&u(e)}}),n&&(!T||T.length<1?Object(ne.jsx)(oe,{genesis:o,rabinApis:A,onCancel:B,onTransferCallback:L,initReceivers:w}):Object(ne.jsx)(ie,{onCancel:B,onTransferCallback:L,initDatas:T}))]})},le=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,879)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),s(e),c(e)}))},de=n(867),be=n(463),fe=window===window.top;de.a({dsn:"https://d223c2a1d1bf44b6a657051ac9a99b16@o877284.ingest.sentry.io/5827823",integrations:[new be.a.BrowserTracing],tracesSampleRate:1}),fe?c.a.render(Object(ne.jsx)(a.a.StrictMode,{children:Object(ne.jsx)(ue,{})}),document.getElementById("root")):function(){X.apply(this,arguments)}(),function(){var e=window.onbeforeunload;window.onbeforeunload=function(t){return!!window.opener||Z(null),e&&e(t)}}(),le()}},[[861,1,2]]]);
//# sourceMappingURL=main.f114947c.chunk.js.map