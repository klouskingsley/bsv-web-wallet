(this["webpackJsonpbsv-web-wallet"]=this["webpackJsonpbsv-web-wallet"]||[]).push([[0],{292:function(e,t){},40:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m})),n.d(t,"h",(function(){return O})),n.d(t,"b",(function(){return w})),n.d(t,"e",(function(){return g})),n.d(t,"f",(function(){return y})),n.d(t,"g",(function(){return k})),n.d(t,"d",(function(){return S})),n.d(t,"c",(function(){return N})),n.d(t,"k",(function(){return E})),n.d(t,"j",(function(){return R})),n.d(t,"i",(function(){return W}));var r=n(8),a=n.n(r),s=n(33),c=n(21),i=n(10),o=n(91),u=n(68),l=n.n(u),d=n(273),p=n(161),f=n(197),b=n(100),h=n(45);function v(e){var t=e===o.a.Mainnet?"":"/test";return"https://api.sensiblequery.com".concat(t)}function j(e){return 0===e.code&&"ok"===e.msg}function x(e){return new Promise((function(t){return setTimeout(t,e)}))}function m(e,t){return e/Math.pow(10,t)}function O(e,t){try{return new i.bsv.Address(t,e),!0}catch(n){return!1}}function w(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.a.Testnet,a=t;a+="|"+n+"|",a+=a.length+"|!@"+7*(7*n.length+t.length);var s=n.match(/[a-z]+/g)?n.match(/[a-z]+/g).length:1,c=n.match(/[A-Z]+/g)?n.match(/[A-Z]+/g).length:1,u=n.match(/[0-9]+/g)?n.match(/[0-9]+/g).length:1;a+=(u+s+c)*n.length+"3571",a+=a+""+a;var l=e.from(a);l=i.bsv.crypto.Hash.sha256(l);for(var d=0;d<=49;d++){var p=e.from(l.toString("hex"));l=i.bsv.crypto.Hash.sha256(p)}var f=i.bsv.crypto.Hash.sha256(e.from(l.toString("hex"))).toString("hex"),b=new i.bsv.PrivateKey(f,r),h=b.toAddress(r).toString();return{address:h,privateKey:b.toString(),publicKey:b.toPublicKey().toString()}}function g(e,t,n,r){var a=e===o.a.Mainnet?"":"/test";return"https://sensiblequery.com".concat(a,"/#/ft/utxo/").concat(r,"/").concat(n,"/").concat(t)}function y(e,t){var n="";return e===o.a.Mainnet&&(n="https://whatsonchain.com/address/"),e===o.a.Testnet&&(n="https://test.whatsonchain.com/address/"),n?n+=t:n}function k(e,t){var n="";return e===o.a.Mainnet&&(n="https://whatsonchain.com/tx/"),e===o.a.Testnet&&(n="https://test.whatsonchain.com/tx/"),n?n+=t:n}function S(e,t){return I.apply(this,arguments)}function I(){return(I=Object(c.a)(a.a.mark((function e(t,n){var r,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=v(t),e.next=3,l.a.get("".concat(r,"/ft/summary/").concat(n,"?cursor=0&size=20"));case 3:if(s=e.sent,c=s.data,!j(c)){e.next=8;break}return e.abrupt("return",(c.data||[]).map((function(e){return{genesis:e.genesis,codehash:e.codehash,tokenName:e.name,tokenSymbol:e.symbol,tokenDecimal:e.decimal,balance:e.balance+e.pendingBalance}})));case 8:throw new Error(c.msg);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,n){return A.apply(this,arguments)}function A(){return(A=Object(c.a)(a.a.mark((function e(t,n,r){var s,c,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 16,s=16*(r-1),c=v(t),e.next=5,l.a.get("".concat(c,"/address/").concat(n,"/utxo?cursor=").concat(s,"&size=").concat(16));case 5:if(i=e.sent,o=i.data,!j(o)){e.next=10;break}return e.abrupt("return",(o.data||[]).map((function(e){return{txId:e.txid,outputIndex:e.vout,satoshis:e.satoshi,address:n}})));case 10:throw new Error(o.msg);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t){return P.apply(this,arguments)}function P(){return(P=Object(c.a)(a.a.mark((function e(t,n){var r,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=v(t),e.next=3,l.a.get("".concat(r,"/address/").concat(n,"/balance"));case 3:if(s=e.sent,c=s.data,!j(c)){e.next=8;break}return e.abrupt("return",c.data.satoshi+c.data.pendingSatoshi);case 8:throw new Error(c.msg);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){return K.apply(this,arguments)}function K(){return(K=Object(c.a)(a.a.mark((function e(t,n){var r,s,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=v(t),e.next=3,l.a.post("".concat(r,"/pushtx"),{txHex:n});case 3:if(s=e.sent,c=s.data,!j(c)){e.next=8;break}return e.abrupt("return",new i.bsv.Transaction(n).hash);case 8:return e.abrupt("return",new Error(c.msg));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t,n,r,a,s){return F.apply(this,arguments)}function F(){return(F=Object(c.a)(a.a.mark((function e(t,n,r,s,c,i){var o,u,l,p,f,b,h,v,j,m,O,w,g,y,k,S,I,T;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.SensibleFT.selectSigners();case 2:return o=e.sent,u=new d.SensibleFT({network:t,purse:r,feeb:.5,signerSelecteds:o.signerSelecteds,signers:o.signers}),console.log("transferSensibleFt",s,t,c,i),e.prev=5,e.next=8,u.transfer({senderWif:r,receivers:s,codehash:c,genesis:i});case 8:return l=e.sent,p=l.txid,f=l.tx,b=W(t,f.serialize(!0)),e.abrupt("return",{txid:p,outputs:b.outputs});case 15:if(e.prev=15,e.t0=e.catch(5),h=e.t0.toString(),v=h.indexOf("The count of utxos should not be more than 3 in transfer")>0,j=h.indexOf("Too many token-utxos")>0,console.log("broadcast sensible ft error "),console.error(e.t0),v||j){e.next=24;break}throw e.t0;case 24:if(!v){e.next=54;break}return e.prev=25,e.next=28,q(t,r);case 28:return e.next=30,x(3e3);case 30:e.next=36;break;case 32:e.prev=32,e.t1=e.catch(25),console.log("merge bsv utxo fail"),console.error(e.t1);case 36:return e.prev=36,e.next=39,u.transfer({senderWif:r,receivers:s,codehash:c,genesis:i});case 39:return m=e.sent,O=m.txid,w=m.tx,g=W(t,w.serialize(!0)),e.abrupt("return",{txid:O,outputs:g.outputs});case 46:if(e.prev=46,e.t2=e.catch(36),console.log("ft transfer fail after bsv utxo merge"),console.error(e.t2),y=e.t2.toString(),j=y.indexOf("Too many token-utxos")>0){e.next=54;break}throw e.t2;case 54:if(!j){e.next=82;break}return e.prev=55,e.next=58,u.merge({ownerWif:r,codehash:c,genesis:i});case 58:return e.next=60,x(3e3);case 60:e.next=67;break;case 62:throw e.prev=62,e.t3=e.catch(55),console.log("merge ft utxo fail"),console.error(e.t3),e.t3;case 67:return e.prev=67,e.next=70,u.transfer({senderWif:r,receivers:s,codehash:c,genesis:i});case 70:return k=e.sent,S=k.txid,I=k.tx,T=W(t,I.serialize(!0)),e.abrupt("return",{txid:S,outputs:T.outputs});case 77:throw e.prev=77,e.t4=e.catch(67),console.log("ft transfer fail after ft utxo merge"),console.error(e.t4),e.t4;case 82:case"end":return e.stop()}}),e,null,[[5,15],[25,32],[36,46],[55,62],[67,77]])})))).apply(this,arguments)}var L=i.bsv.crypto.Signature,H=L.SIGHASH_ALL|L.SIGHASH_FORKID;function B(e,t,n,r){var a=new i.bsv.Transaction.Signature({publicKey:e.publicKey,prevTxId:t.inputs[n].prevTxId,outputIndex:t.inputs[n].outputIndex,inputIndex:n,signature:i.bsv.Transaction.Sighash.sign(t,e,r,n,t.inputs[n].output.script,t.inputs[n].output.satoshisBN),sigtype:r});t.inputs[n].setScript(i.bsv.Script.buildPublicKeyHashIn(a.publicKey,a.signature.toDER(),a.sigtype))}function R(e,t,n){return _.apply(this,arguments)}function _(){return(_=Object(c.a)(a.a.mark((function e(t,n,r){var s,c,o,u,l,d,p,f,b,v,j,x,m;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("arguments",t,n,r),s=new i.bsv.PrivateKey(n,t).toAddress(t),e.next=4,N(t,s);case 4:if(c=e.sent,o=r.reduce((function(e,t){return h.e(e,t.amount)}),0),!(c<+o)){e.next=8;break}throw new Error("Insufficient_Balance");case 8:u=0,l=[],(d=new i.bsv.Transaction).feePerKb(500),p=456,f=1;case 14:return e.next=16,T(t,s,f);case 16:b=e.sent,v=0;case 18:if(!(v<b.length)){e.next=28;break}if(j=b[v],u=h.e(u,j.satoshis),l.push(j),d.addInput(new i.bsv.Transaction.Input.PublicKeyHash({output:new i.bsv.Transaction.Output({script:i.bsv.Script.buildPublicKeyHashOut(j.address),satoshis:j.satoshis}),prevTxId:j.txId,outputIndex:j.outputIndex,script:i.bsv.Script.empty()})),!(+o<=+u)){e.next=25;break}return e.abrupt("break",28);case 25:v++,e.next=18;break;case 28:if(!(+o<=+u)){e.next=30;break}return e.abrupt("break",33);case 30:f++,e.next=14;break;case 33:return r.forEach((function(e){d.to(e.address,+e.amount)})),+h.c(u,+o)>0&&d.change(s),+h.c(h.e(u,d.getFee(),p),+o)>0&&(d.clearOutputs(),r.forEach((function(e){d.to(e.address,+e.amount)}))),d.inputs.forEach((function(e,t){B(new i.bsv.PrivateKey(n),d,t,H)})),e.next=39,C(t,d.serialize());case 39:return x=e.sent,m=W(t,d.serialize(!0)),e.abrupt("return",{txid:x,outputs:m.outputs});case 42:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t){return M.apply(this,arguments)}function M(){return(M=Object(c.a)(a.a.mark((function e(t,n){var r,s,c,o,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new i.bsv.PrivateKey(n,t).toAddress(t),e.next=3,T(t,r,1);case 3:return s=e.sent,(c=new i.bsv.Transaction).feePerKb(500),s.forEach((function(e){c.addInput(new i.bsv.Transaction.Input.PublicKeyHash({output:new i.bsv.Transaction.Output({script:i.bsv.Script.buildPublicKeyHashOut(e.address),satoshis:e.satoshis}),prevTxId:e.txId,outputIndex:e.outputIndex,script:i.bsv.Script.empty()}))})),c.change(r),c.inputs.forEach((function(e,t){B(new i.bsv.PrivateKey(n),c,t,H)})),e.next=11,C(t,c.serialize());case 11:return o=e.sent,u=W(t,c.serialize(!0)),e.abrupt("return",{txid:o,outputs:u.outputs});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var D=function(t,n){var r=e.from(t,"hex").reverse(),a=e.alloc(4,0);return a.writeUInt32LE(n),Object(i.toHex)(e.concat([r,a]))},z=function(e){return 0===f.getFlag(e).compare(f.PROTO_FLAG)},G=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mainnet",r=z(t);if(!r)return null;var a=p.parseDataPart(t),c=new i.bsv.Address(e.from(a.tokenAddress,"hex"),n).toString(),o=D(a.tokenID.txid,a.tokenID.index),u=Object(b.getCodeHash)(new i.bsv.Script(t));return Object(s.a)(Object(s.a)({},a),{},{genesis:o,codehash:u,tokenAddress:c})};function W(e,t){var n;try{n=new i.bsv.Transaction(t)}catch(r){return{error:r.message}}return{inputs:n.inputs.map((function(t,n){var a=G(t.script.toBuffer(),e),c={index:n,prevTxId:t.prevTxId.toString("hex"),outputIndex:t.outputIndex,script:t.script.toString("hex")};try{var i=t.script.toAddress(e);i&&(c.address=i.toString())}catch(r){}return a?a.tokenAmount<=0?c:c=Object(s.a)(Object(s.a)({},c),{},{isFt:!0,ftDetail:{genesis:a.genesis,codehash:a.codehash,address:a.tokenAddress,decimal:a.decimalNum,name:a.tokenName,symbol:a.tokenSymbol}}):c})),outputs:n.outputs.map((function(t,n){var a=G(t.script.toBuffer(),e),c={index:n,satoshis:t.satoshis,script:t.script.toString("hex")};try{var i=t.script.toAddress(e);i&&(c.address=i.toString())}catch(r){}return a?a.tokenAmount<=0?c:c=Object(s.a)(Object(s.a)({},c),{},{isFt:!0,ftDetail:{genesis:a.genesis,codehash:a.codehash,address:a.tokenAddress,decimal:a.decimalNum,name:a.tokenName,symbol:a.tokenSymbol,amount:a.tokenAmount}}):c})),txid:n.hash}}}).call(this,n(9).Buffer)},434:function(e,t,n){},45:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return u}));var r=n(67),a=n.n(r);function s(e){for(var t=new a.a(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t=t.div(new a.a(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]));return t.toString()}function c(e){for(var t=new a.a(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t=t.multipliedBy(new a.a(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]));return t.toString()}function i(e){for(var t=new a.a(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t=t.plus(new a.a(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]));return t.toString()}function o(e){for(var t=new a.a(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)t=t.minus(new a.a(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]));return t.toString()}function u(e){return new a.a(10).pow(e).toString()}},456:function(e,t){},465:function(e,t){},468:function(e,t){},469:function(e,t){},491:function(e,t){},493:function(e,t){},502:function(e,t){},504:function(e,t){},530:function(e,t){},532:function(e,t){},537:function(e,t){},539:function(e,t){},545:function(e,t){},547:function(e,t){},559:function(e,t){},562:function(e,t){},634:function(e,t){},744:function(e,t,n){},819:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),s=n(41),c=n.n(s),i=(n(434),n(8)),o=n.n(i),u=n(33),l=n(21),d=n(26),p=n(165),f=n(829),b=n(114),h=n(828),v=n(827),j=n(825),x=n(823),m=n(137),O=n(75),w=n(824),g=n(423),y=n(830),k=n(826),S=n(831),I=n(832),T=n(428),A=n(833),N=n(427),P=n(412),C=n(40),K=n(198),E=n(413),F={satotxApiPrefix:"https://api.satotx.com",satotxPubKey:"25108ec89eb96b99314619eb5b124f11f00307a833cda48f5ab1865a04d4cfa567095ea4dd47cdf5c7568cd8efa77805197a67943fe965b0a558216011c374aa06a7527b20b0ce9471e399fa752e8c8b72a12527768a9fc7092f1a7057c1a1514b59df4d154df0d5994ff3b386a04d819474efbd99fb10681db58b1bd857f6d5"},L={account:null,key:null,bsvBalance:null,sensibleFtList:[],satotxConfigMap:new Map};L.satotxConfigMap.set("5b3bfa8e7600d701e70551075573ea28fd16c25a39fe2bdafdc3e08b11ca76b800000000",[F,F,F]);var H=Object(E.a)(L),B=H.useGlobalState,R=H.getGlobalState,_=H.setGlobalState,q="accountStorageKey";function M(e){var t=e?JSON.stringify(e):"";localStorage.setItem(q,t)}function D(){var e=localStorage.getItem(q);return e?JSON.parse(e):null}var z=0,G=0;function W(){return Y.apply(this,arguments)}function Y(){return(Y=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearInterval(z),t=function(){var e=Object(l.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=R("account"),n=R("key"),t&&n){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(C.c)(t.network,n.address);case 7:r=e.sent,_("bsvBalance",{balance:r}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.log("getAddressBsvBalance err",t.network,n.address,e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(){return e.apply(this,arguments)}}(),e.next=4,t();case 4:z=window.setInterval(t,5e3);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return U.apply(this,arguments)}function U(){return(U=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearInterval(G),t=function(){var e=Object(l.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=R("account"),n=R("key"),t&&n){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,Object(C.d)(t.network,n.address);case 7:r=e.sent,_("sensibleFtList",r),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.log("getAddressSensibleFtList err",t.network,n.address,e.t0);case 14:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(){return e.apply(this,arguments)}}(),e.next=4,t();case 4:G=window.setInterval(t,5e3);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return X.apply(this,arguments)}function X(){return(X=Object(l.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M(t),!t){e.next=10;break}return n=Object(C.b)(t.email,t.password,t.network),_("account",t),_("key",n),e.next=7,J();case 7:W(),e.next=12;break;case 10:_("account",null),_("key",null);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function Q(){return(Q=Object(l.a)(o.a.mark((function e(){var t,n,r,a,s,c,i,u,d,p,f,b,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window!==window.top){e.next=2;break}return e.abrupt("return");case 2:t=JSON.parse(decodeURIComponent(window.location.hash.substr(1))),n=K(window.top,"*"),r=t.id,a=null,s=null,c=[],i=null,n.emit(r,{type:"ready"}),u=function(e,t){return!e&&!t||(null===e||void 0===e?void 0:e.balance)===(null===t||void 0===t?void 0:t.balance)},d=function(e,t){if(e.length!==t.length)return!1;e.sort((function(e,t){return e.genesis.localeCompare(t.genesis)})),t.sort((function(e,t){return e.genesis.localeCompare(t.genesis)}));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(r.genesis!==a.genesis)return!1;if(r.balance!==a.balance)return!1}return!0},p=function(e,t){return(null===e||void 0===e?void 0:e.email)===(null===t||void 0===t?void 0:t.email)&&(null===e||void 0===e?void 0:e.network)===(null===t||void 0===t?void 0:t.network)&&(null===e||void 0===e?void 0:e.password)===(null===t||void 0===t?void 0:t.password)},f=function(){var e=Object(l.a)(o.a.mark((function e(){var t,l,f,b,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=D(),p(t,a)||n.emit(r,{type:"account",data:t}),!(a=t)){e.next=30;break}return i=Object(C.b)(a.email,a.password,a.network),e.prev=5,e.next=8,Object(C.c)(a.network,i.address);case 8:l=e.sent,f=u(s,{balance:l}),s={balance:l},f||n.emit(r,{type:"bsvBalance",data:s}),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(5);case 16:return e.prev=16,e.next=19,Object(C.d)(a.network,i.address);case 19:b=e.sent,h=d(c,b),c=b,h||n.emit(r,{type:"sensibleFtBalance",data:c}),e.next=27;break;case 25:e.prev=25,e.t1=e.catch(16);case 27:return e.abrupt("return",!0);case 30:return e.abrupt("return",!1);case 31:case"end":return e.stop()}}),e,null,[[5,14],[16,25]])})));return function(){return e.apply(this,arguments)}}(),(b=function(e,t){n.on(r,function(){var a=Object(l.a)(o.a.mark((function a(s,c){var i,u,l,d;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=c.type,u=c.data,"request"!==i||(null===u||void 0===u?void 0:u.method)!==e){a.next=13;break}return l=u.requestId,a.prev=3,a.next=6,t(u.params);case 6:d=a.sent,n.emit(r,{type:"response",data:{requestId:l,method:e,response:d}}),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(3),n.emit(r,{type:"response",data:{requestId:l,method:e,error:a.t0.toString()}});case 13:case"end":return a.stop()}}),a,null,[[3,10]])})));return function(e,t){return a.apply(this,arguments)}}())})("getAccount",Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:if(a){e.next=4;break}return e.abrupt("return",null);case 4:return e.abrupt("return",{name:a.email,email:a.email,network:a.network});case 5:case"end":return e.stop()}}),e)})))),b("getBsvBalance",Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return e.abrupt("return",s);case 3:case"end":return e.stop()}}),e)})))),b("getSensibleFtBalance",Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return e.abrupt("return",c);case 3:case"end":return e.stop()}}),e)})))),b("getAddress",Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:if(i){e.next=4;break}return e.abrupt("return",null);case 4:return e.abrupt("return",i.address);case 5:case"end":return e.stop()}}),e)})))),b("logout",Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M(null);case 1:case"end":return e.stop()}}),e)})))),b("ping",(function(){return null}));case 21:return e.next=23,f();case 23:return h=e.sent,e.next=26,Z(h?3e3:500);case 26:e.next=21;break;case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(r.useRef)(!1);Object(r.useEffect)((function(){t&&!n.current&&(n.current=!0,e())}),[e,t])}n(744);var ee=n(45),te=n(6),ne=p.a.Option;function re(){var e=B("account"),t=Object(d.a)(e,1)[0],n=B("key"),a=Object(d.a)(n,1)[0],s=Object(r.useState)(!1),c=Object(d.a)(s,2),i=c[0],o=c[1],u=Object(r.useState)(""),l=Object(d.a)(u,2),j=l[0],x=l[1],m=Object(r.useState)(""),O=Object(d.a)(m,2),w=O[0],g=O[1],y=Object(r.useState)(!1),k=Object(d.a)(y,2),S=k[0],I=k[1];return Object(te.jsxs)("div",{className:"header",children:[Object(te.jsx)("div",{className:"logo",children:"Web Wallet"}),t&&Object(te.jsx)(f.a,{title:"",content:Object(te.jsxs)(te.Fragment,{children:[Object(te.jsx)(b.a,{type:"link",onClick:function(){V(null)},children:"Logout"}),Object(te.jsx)("br",{}),Object(te.jsx)(b.a,{type:"link",onClick:function(){var e=Object(C.f)(t.network,a.address);window.open(e)},children:"History"}),Object(te.jsx)("br",{}),Object(te.jsx)(b.a,{type:"link",onClick:function(){window.open("http://github.com")},children:"Source Code"}),Object(te.jsx)("br",{}),Object(te.jsx)(b.a,{type:"link",onClick:function(){return o(!0)},children:"decode rawtx"})]}),children:Object(te.jsx)(b.a,{type:"link",children:t.email})}),Object(te.jsxs)(h.a,{visible:i,onCancel:function(){return o(!1)},children:[Object(te.jsx)(v.a.TextArea,{rows:4,value:j,onChange:function(e){return x(e.target.value)}}),Object(te.jsxs)(p.a,{style:{width:180},placeholder:"Select network",value:w,onChange:function(e){return g(e)},children:[Object(te.jsx)(ne,{value:"mainnet",children:"mainnet"}),Object(te.jsx)(ne,{value:"testnet",children:"testnet"})]}),Object(te.jsx)(b.a,{type:"primary",onClick:function(){var e=Object(C.i)(w,j);console.log("decodeTx res",e)},children:"decode"})]}),Object(te.jsx)(h.a,{visible:S,onCancel:function(){return I(!1)}})]})}function ae(){var e=B("account"),t=Object(d.a)(e,1)[0],n=j.a.useForm(),r=Object(d.a)(n,1)[0];return t?null:Object(te.jsx)(x.a,{className:"card",title:"Login",bordered:!1,children:Object(te.jsxs)(j.a,{form:r,layout:"vertical",onFinish:function(){h.a.confirm({title:"\u5b89\u5168\u6ce8\u610f",content:Object(te.jsxs)("div",{children:["Web\u94b1\u5305\u7684\u79c1\u94a5\u662f\u901a\u8fc7\u7528\u6237\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u5b9e\u65f6\u8ba1\u7b97\u5f97\u5230\uff0c\u4e0d\u4f1a\u4e0a\u4f20\u670d\u52a1\u5668\uff0c\u4e5f\u4e0d\u4f1a\u4fdd\u5b58\u5728\u672c\u5730(\u4ee3\u7801\u89c1",Object(te.jsx)("a",{href:"https://github.com/klouskingsley/bsv-web-wallet",target:"_blank",rel:"noreferrer",children:"github"}),")\u3002\u4ec5\u4f9b\u65b9\u4fbf\u7528\u6237\u6d4b\u8bd5\u4e4b\u7528\uff0c\u4e0d\u9002\u5408\u5b58\u653e\u5927\u91cf\u8d44\u91d1\uff0c\u5efa\u8bae\u7528\u6237\u59a5\u5584\u4fdd\u7ba1\u7528\u6237\u540d+\u5bc6\u7801\u7ec4\u5408\u4ee5\u9632\u8d44\u91d1\u4e22\u5931\uff0c\u6216\u5728\u4f7f\u7528\u5b8c\u6210\u4e4b\u540e\u5c06\u5269\u4f59\u8d44\u91d1\u8f6c\u79fb\u3002\u7528\u6237\u540d+\u5bc6\u7801\u7ec4\u5408\u4e22\u5931(\u5fd8\u8bb0\uff0c\u88ab\u76d7\u7b49\u60c5\u5f62)\u4f1a\u5bfc\u81f4\u8d44\u4ea7\u4e22\u5931"]}),onOk:function(){V(r.getFieldsValue())}})},children:[Object(te.jsx)(j.a.Item,{name:"email",rules:[{type:"email",required:!0,message:"Please input a valid Email!"}],children:Object(te.jsx)(v.a,{prefix:Object(te.jsx)(S.a,{className:"site-form-item-icon"}),placeholder:"Email"})}),Object(te.jsx)(j.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"},{min:6,message:"Password at least 6 chars",transform:function(e){return e&&e.trim()}}],children:Object(te.jsx)(v.a.Password,{prefix:Object(te.jsx)(I.a,{className:"site-form-item-icon"}),type:"password",visibilityToggle:!0,placeholder:"Password"})}),Object(te.jsx)(j.a.Item,{name:"network",label:"Network",rules:[{required:!0}],children:Object(te.jsxs)(p.a,{placeholder:"Select network",children:[Object(te.jsx)(ne,{value:"mainnet",children:"mainnet"}),Object(te.jsx)(ne,{value:"testnet",children:"testnet"})]})}),Object(te.jsx)(j.a.Item,{children:Object(te.jsx)(b.a,{type:"primary",htmlType:"submit",className:"login-form-button",children:"Log in"})})]})})}function se(e){var t=e.onWithDraw,n=e.onTransfer,r=B("key"),a=Object(d.a)(r,1)[0],s=B("account"),c=Object(d.a)(s,1)[0],i=B("bsvBalance"),o=Object(d.a)(i,1)[0],u=B("sensibleFtList"),l=Object(d.a)(u,1)[0];if(!a)return null;var p=function(e){return n(e||"")};return[Object(te.jsx)(x.a,{className:"card",title:"Account Info",bordered:!1,actions:Object(te.jsxs)(te.Fragment,{children:[Object(te.jsx)(b.a,{type:"link",onClick:function(){var e=Object(C.f)(c.network,a.address);window.open(e)},children:"history"}),",",Object(te.jsx)(b.a,{type:"link",onClick:t,children:"withdraw"}),","]}),children:Object(te.jsxs)(j.a,{layout:"vertical",children:[Object(te.jsxs)(j.a.Item,{label:"".concat(c.network," address"),children:[Object(te.jsx)(v.a,{value:a.address}),Object(te.jsx)("div",{style:{margin:20},children:Object(te.jsx)(P,{value:a.address})})]}),Object(te.jsx)(j.a.Item,{label:"privateKey",children:Object(te.jsx)(v.a.Password,{visibilityToggle:!0,value:a.privateKey})})]})}),Object(te.jsx)(x.a,{className:"card",title:"Asset",bordered:!1,children:Object(te.jsxs)(j.a,{layout:"vertical",children:[o&&Object(te.jsx)(j.a.Item,{label:"BSV balance",children:Object(te.jsxs)(m.a,{justify:"space-between",children:[Object(te.jsx)(O.a,{span:16,children:Object(te.jsx)("div",{children:Object(C.a)(o.balance,8)})}),Object(te.jsx)(O.a,{span:7,children:Object(te.jsx)(b.a,{type:"link",onClick:function(){return p("")},children:"Transfer BSV"})})]})}),l.length>0&&Object(te.jsx)(j.a.Item,{label:"Sensible Fungible Token",children:Object(te.jsx)(w.b,{itemLayout:"horizontal",dataSource:l,renderItem:function(e){return Object(te.jsxs)(w.b.Item,{actions:Object(te.jsx)(te.Fragment,{children:Object(te.jsx)(f.a,{placement:"topRight",content:Object(te.jsxs)(te.Fragment,{children:[Object(te.jsxs)("div",{children:["codehash: ",e.codehash]}),",",Object(te.jsxs)("div",{children:["genesis: ",e.genesis]}),","]}),children:Object(te.jsx)("a",{href:Object(C.e)(c.network,a.address,e.genesis,e.codehash),rel:"noreferrer",target:"_blank",children:"more info"},"list-loadmore-more")})}),children:[Object(te.jsx)(w.b.Item.Meta,{title:e.tokenSymbol,description:e.tokenName}),Object(te.jsxs)(m.a,{children:[Object(te.jsx)(O.a,{children:Object(te.jsxs)("div",{style:{height:"100%",display:"flex",alignItems:"center"},children:["Balance:"," ",Object(C.a)(e.balance,e.tokenDecimal)]})}),Object(te.jsx)(O.a,{children:Object(te.jsx)(b.a,{type:"link",onClick:function(){return p(e.genesis)},children:"Go Transfer"})})]})]},e.genesis)}})})]})})]}function ce(e){var t=e.genesis,n=void 0===t?"":t,a=e.initReceivers,s=void 0===a?[]:a,c=e.onCancel,i=e.onTransferCallback,p=B("key"),f=Object(d.a)(p,1)[0],w=B("bsvBalance"),S=Object(d.a)(w,1)[0],I=B("account"),P=Object(d.a)(I,1)[0],K=B("sensibleFtList"),E=Object(d.a)(K,1)[0],L=B("satotxConfigMap"),H=Object(d.a)(L,1)[0],R=j.a.useForm(),_=Object(d.a)(R,1)[0],q=Object(r.useState)(!1),M=Object(d.a)(q,2),D=M[0],z=M[1],G=!(s.length>0);if($((function(){var e=""===n,t=E.find((function(e){return e.genesis===n})),r=e?8:t.tokenDecimal;console.log("initReceivers",s,s.map((function(e){return{address:e.address,amount:ee.d(e.amount,ee.b(r))}}))),_.setFieldsValue({receiverList:s.map((function(e){return{address:e.address,amount:ee.a(e.amount,ee.b(r))}}))})}),f&&S&&s.length),!f)return null;if(!S)return null;if(n&&!E.length)return null;var W=""===n,Y=E.find((function(e){return e.genesis===n}));if(!W&&!Y)return null;var J=W?"BSV":Y.tokenSymbol,U=W?8:Y.tokenDecimal,V=W?S.balance:Y.balance,X=Object(C.a)(V,U),Z=function(){var e=Object(l.a)(o.a.mark((function e(){var t,r,a,s,c,d,p,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_.getFieldsValue(),r=t.receiverList,a=r.reduce((function(e,t){return ee.e(e,t.amount)}),0),s=ee.d(a,ee.b(U)),!(V<+s)){e.next=7;break}return i({error:c="Insufficient ft balance"}),e.abrupt("return",g.b.error(c));case 7:d=r.map((function(e){return{address:e.address,amount:ee.d(e.amount,ee.b(U))}})),p=function(){var e=Object(l.a)(o.a.mark((function e(){var t,n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z(!0),t="",e.prev=2,e.next=5,Object(C.j)(P.network,f.privateKey,d);case 5:r=e.sent,n=r,t=r.txid,e.next=16;break;case 10:e.prev=10,e.t0=e.catch(2),a="broadcast error: "+e.t0.toString(),i({error:a}),console.log("broadcast bsv error ",e.t0),g.b.error(e.t0.toString());case 16:z(!1),t&&(i({response:Object(u.a)({},n)}),h.a.success({title:"Transaction broadcast success",content:Object(te.jsxs)("div",{children:["txid:"," ",Object(te.jsx)("a",{target:"_blank",rel:"noreferrer",href:Object(C.g)(P.network,t),children:t})]})}));case 18:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=Object(l.a)(o.a.mark((function e(){var t,r,a,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z(!0),t="",e.prev=2,a=H.get(n)||[F,F,F],e.next=6,Object(C.k)(P.network,a,f.privateKey,d,Y.codehash,Y.genesis);case 6:s=e.sent,r=s,t=s.txid,e.next=16;break;case 11:e.prev=11,e.t0=e.catch(2),console.log("broadcast sensible ft error "),console.error(e.t0),g.b.error(e.t0.toString());case 16:z(!1),t&&(i({response:Object(u.a)({},r)}),h.a.success({title:"Transaction broadcast success",content:Object(te.jsxs)("div",{children:["txid:"," ",Object(te.jsx)("a",{target:"_blank",rel:"noreferrer",href:Object(C.g)(P.network,t),children:t})]})}));case 18:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}(),h.a.confirm({title:"Confirm the transaction",onOk:function(){W?p():b()}});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(te.jsx)(x.a,{className:"card",title:Object(te.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){c()},children:[Object(te.jsx)(T.a,{}),"Transfer"]}),loading:D,bordered:!1,children:Object(te.jsxs)(j.a,{form:_,layout:"vertical",onFinish:Z,children:[Object(te.jsx)("div",{className:"transfer-line",children:W?"Coin: ".concat(J):"Token: ".concat(J)}),!W&&Object(te.jsxs)("div",{className:"transfer-line",children:["Genesis: ",Y.genesis]}),!W&&Object(te.jsxs)("div",{className:"transfer-line",children:["Codehash: ",Y.codehash]}),Object(te.jsx)(m.a,{justify:"space-between",style:{margin:"10px 0"},children:Object(te.jsx)(O.a,{span:14,children:Object(te.jsx)("div",{style:{fontWeight:700},children:"Input"})})}),Object(te.jsx)("div",{className:"transfer-line",children:"Balance: ".concat(X)}),Object(te.jsx)("div",{className:"transfer-line",children:"From Address: ".concat(f.address)}),Object(te.jsx)(m.a,{justify:"space-between",style:{margin:"10px 0"},children:Object(te.jsx)(O.a,{span:14,children:Object(te.jsx)("div",{style:{fontWeight:700},children:"Output"})})}),Object(te.jsx)(j.a.List,{name:"receiverList",children:function(e,t){var n=t.add,r=t.remove;return Object(te.jsxs)(te.Fragment,{children:[e.map((function(e,t,n){for(var a=arguments.length,s=new Array(a>3?a-3:0),c=3;c<a;c++)s[c-3]=arguments[c];return Object(te.jsxs)(y.b,{style:{display:"flex",marginBottom:8},align:"baseline",children:[Object(te.jsx)(j.a.Item,Object(u.a)(Object(u.a)({},s),{},{name:[t,"address"],fieldKey:[n,"address"],rules:[{required:!0,message:"Please input the address"},{message:"invalid address",validator:function(e,t){return Object(C.h)(P.network,t)?Promise.resolve():Promise.reject()}}],children:Object(te.jsx)(v.a,{placeholder:"Input the address",disabled:!G})})),Object(te.jsx)(j.a.Item,Object(u.a)(Object(u.a)({},s),{},{name:[t,"amount"],fieldKey:[n,"amount"],rules:[{required:!0,message:"Please input amount"}],children:Object(te.jsx)(k.a,{placeholder:"Amount",min:0,disabled:!G})})),Object(te.jsx)(b.a,{disabled:!G,size:"small",onClick:function(){return r(t)},shape:"circle",icon:Object(te.jsx)(A.a,{})})]},e.fieldKey)})),Object(te.jsx)(j.a.Item,{children:Object(te.jsx)(b.a,{type:"dashed",onClick:function(){return n()},icon:Object(te.jsx)(N.a,{}),disabled:!G,children:"Add Output"})})]})}}),Object(te.jsx)(j.a.Item,{children:Object(te.jsx)(b.a,{type:"primary",htmlType:"submit",block:!0,children:"Transfer"})})]})})}var ie=function(){Object(r.useEffect)((function(){V(D())}),[]);var e=Object(r.useState)(!1),t=Object(d.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(""),c=Object(d.a)(s,2),i=c[0],o=c[1],l=B("account"),p=Object(d.a)(l,1)[0],f=B("key"),b=Object(d.a)(f,1)[0],v=B("bsvBalance"),j=Object(d.a)(v,1)[0],x=B("sensibleFtList"),m=Object(d.a)(x,1)[0],O=Object(r.useState)([]),w=Object(d.a)(O,2),g=w[0],y=w[1],k=function(){if(!window.opener)return null;var e=window.location.hash.substr(1);try{var t=JSON.parse(decodeURIComponent(e));if("popup"===t.type&&"object"===typeof t.data)return t}catch(n){}return null},S=function(e){var t=k();t&&K(window.opener,"*").emit(t.id,{type:"response",data:Object(u.a)(Object(u.a)({},t.data.data),e)})},I=(null===b||void 0===b?void 0:b.address)&&(null===p||void 0===p?void 0:p.network),T=I&&j&&j.balance>=0;return $((function(){var e=k();if(e&&"request"===e.data.type){var t=e.data.data,n=t.method,r=t.params;"requestAccount"===n&&h.a.confirm({title:"Connect",content:Object(te.jsxs)("div",{children:["Allow ",Object(te.jsx)("b",{children:r.name})," to connect your web wallet"]}),onOk:function(){S({response:!0})},onCancel:function(){S({error:"user reject"})}})}}),!!I),$((function(){var e=k();if(console.log("bsv hash data",e),e&&"request"===e.data.type){var t=e.data.data,n=t.method,r=t.params;if("transferBsv"===n)r.receivers.reduce((function(e,t){return ee.e(e,t.amount)}),0)>=j.balance?S({error:"insufficient bsv balance"}):(a(!0),y(r.receivers))}}),!!T),$((function(){var e=k();if(console.log("hashdata",e),e&&"request"===e.data.type){var t=e.data.data,n=t.method,r=t.params;if("transferSensibleFt"===n){var s=r.receivers.reduce((function(e,t){return ee.e(e,t.amount)}),0);console.log("outputTotal",s);var c=m.find((function(e){return e.genesis===r.genesis}));console.log("ft",c),c?+s>=+c.balance?S({error:"insufficient ft balance"}):(a(!0),o(r.genesis),y(r.receivers)):S({error:"insufficient ft balance"})}}}),!!T),Object(r.useEffect)((function(){var e=window.onbeforeunload;window.onbeforeunload=function(t){return S({error:"use closed"}),e(t)}})),Object(te.jsxs)("div",{className:"App",style:{overflow:"hidden"},children:[Object(te.jsx)(re,{accountName:"harry"}),Object(te.jsx)(ae,{}),!n&&Object(te.jsx)(se,{onTransfer:function(e){a(!0),e&&o(e)}}),n&&Object(te.jsx)(ce,{genesis:i,onCancel:function(){a(!1),o("")},onTransferCallback:S,initReceivers:g})]})},oe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,834)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),s(e),c(e)}))};window===window.top?c.a.render(Object(te.jsx)(a.a.StrictMode,{children:Object(te.jsx)(ie,{})}),document.getElementById("root")):function(){Q.apply(this,arguments)}(),function(){var e=window.onbeforeunload;window.onbeforeunload=function(t){return!!window.opener||V(null),e(t)}}(),oe()},91:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r,a,s=n(8),c=n.n(s),i=n(21),o=n(130),u=n(196),l=n(10);!function(e){e.Testnet="testnet",e.Mainnet="mainnet",e.STN="STN"}(r||(r={})),function(e){e[e.ALL=65]="ALL",e[e.SINGLE=67]="SINGLE",e[e.NONE=66]="NONE",e[e.ANYONECANPAY_ALL=193]="ANYONECANPAY_ALL",e[e.ANYONECANPAY_SINGLE=195]="ANYONECANPAY_SINGLE",e[e.ANYONECANPAY_NONE=194]="ANYONECANPAY_NONE"}(a||(a={}));var d=function e(t){Object(o.a)(this,e),this.network=void 0,this.network=t},p=n(68),f=n.n(p);function b(e,t,n,r,a){t.inputs[n].output=new l.bsv.Transaction.Output({script:a.script,satoshis:a.satoshis});var s=new l.bsv.Transaction.Signature({publicKey:e.publicKey,prevTxId:a.txHash,outputIndex:a.outputIndex,inputIndex:n,signature:l.bsv.Transaction.Sighash.sign(t,e,r,n,t.inputs[n].output.script,t.inputs[n].output.satoshisBN),sigtype:r});return l.bsv.Script.buildPublicKeyHashIn(s.publicKey,s.signature.toDER(),s.sigtype).toHex()}function h(e){var t=new l.bsv.Transaction;return e.inputs.forEach((function(e){t.addInput(new l.bsv.Transaction.Input({prevTxId:e.utxo.txHash,outputIndex:e.utxo.outputIndex,sequenceNumber:e.sequence,script:e.script?l.bsv.Script.fromHex(e.script):new l.bsv.Script}),l.bsv.Script.fromHex(e.utxo.script),e.utxo.satoshis)})),e.outputs.forEach((function(e){t.addOutput(new l.bsv.Transaction.Output({script:l.bsv.Script.fromHex(e.script),satoshis:e.satoshis}))})),t.nLockTime=e.nLockTime||0,t}function v(e){return h(e).toString()}var j=n(429),x=n(422),m=function(e){Object(j.a)(n,e);var t=Object(x.a)(n);function n(e,a){var s;return Object(o.a)(this,n),(s=t.call(this,e)).API_PREFIX=void 0,s.privKey=void 0,s.API_PREFIX="https://api.whatsonchain.com/v1/bsv/".concat(e===r.Testnet?"test":"main"),s.privKey=a?new l.bsv.PrivateKey.fromWIF(a):new l.bsv.PrivateKey.fromRandom(e),s}return Object(u.a)(n,[{key:"requestAccount",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getbalance",value:function(){var e=Object(i.a)(c.a.mark((function e(){var t,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("".concat(this.API_PREFIX,"/address/").concat(this.privKey.toAddress(),"/balance"),{timeout:5e3});case 2:return t=e.sent,n=t.data,e.abrupt("return",n.confirmed+n.unconfirmed);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signRawTransaction",value:function(){var e=Object(i.a)(c.a.mark((function e(t,n,r){var a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h(t),s=t.inputs[n].utxo,e.abrupt("return",b(this.privKey,a,n,r,s));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getSignature",value:function(){var e=Object(i.a)(c.a.mark((function e(t,n,r){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h(t),e.abrupt("return",Object(l.signTx)(a,this.privKey,a.inputs[n].output.script.toASM(),a.inputs[n].output.satoshisBN,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendRawTransaction",value:function(){var e=Object(i.a)(c.a.mark((function e(t){var n,r,a,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Math.max(1,t.length/2/1024),r=Math.max(1e4,1e3*n),e.next=4,f.a.post("".concat(this.API_PREFIX,"/tx/raw"),{txhex:t},{timeout:r});case 4:return a=e.sent,s=a.data,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"listUnspent",value:function(){var e=Object(i.a)(c.a.mark((function e(t,n){var r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.a.get("".concat(this.API_PREFIX,"/address/").concat(this.privKey.toAddress(),"/unspent"),{timeout:1e4}).then((function(e){return e.data.filter((function(e){return e.value>=t})).map((function(e){return{txHash:e.tx_hash,outputIndex:e.tx_pos,satoshis:e.value,script:l.bsv.Script.buildPublicKeyHashOut(r.privKey.toAddress()).toHex()}}))})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getRawChangeAddress",value:function(e){var t=this;return new Promise((function(e){return e(t.privKey.toAddress()+"")}))}},{key:"getPublicKey",value:function(e){var t=this;return new Promise((function(e){return e(Object(l.toHex)(t.privKey.publicKey))}))}}]),n}(d),O=2e3;(function(){function e(){Object(o.a)(this,e)}return Object(u.a)(e,null,[{key:"setWallet",value:function(t){e.wallet=t}},{key:"version",value:function(){return"0.0.1"}},{key:"loadContract",value:function(e){return f.a.get(e,{timeout:1e4}).then((function(e){return{contractClass:Object(l.buildContractClass)(e.data),types:Object(l.buildTypeClasses)(e.data)}}))}},{key:"buildDeployTx",value:function(){var e=Object(i.a)(c.a.mark((function e(t,n,s,o){var u,d,p,f,b,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new m(r.Mainnet,s),d=new m(r.Mainnet,o),e.next=4,u.getRawChangeAddress();case 4:return p=e.sent,e.next=7,d.getRawChangeAddress();case 7:return f=e.sent,(b={inputs:[],outputs:[]}).outputs.push({script:t.lockingScript.toHex(),satoshis:2*n}),h=n+O,e.abrupt("return",u.listUnspent(h,{purpose:"change"}).then(function(){var e=Object(i.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}throw new Error("no utxos");case 2:if(b.inputs.push({utxo:t[0],script:"",sequence:0}),!((r=t[0].satoshis-n-O)<=0)){e.next=6;break}throw new Error("fund is not enough");case 6:return b.outputs.push({script:l.bsv.Script.buildPublicKeyHashOut(p).toHex(),satoshis:r}),e.abrupt("return",b);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return d.listUnspent(h,{purpose:"change"}).then(function(){var t=Object(i.a)(c.a.mark((function t(r){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==r.length){t.next=2;break}throw new Error("no utxos");case 2:if(e.inputs.push({utxo:r[0],script:"",sequence:0}),!((a=r[0].satoshis-n-O)<=0)){t.next=6;break}throw new Error("fund is not enough");case 6:return e.outputs.push({script:l.bsv.Script.buildPublicKeyHashOut(f).toHex(),satoshis:a}),t.abrupt("return",e);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})).then((function(e){return u.signRawTransaction(e,0,a.ALL).then((function(t){return e.inputs[0].script=t,e}))})).then((function(e){return d.signRawTransaction(e,1,a.ALL).then((function(t){return e.inputs[1].script=t,e}))})));case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"sendRawTx",value:function(){var t=Object(i.a)(c.a.mark((function t(n){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.wallet.sendRawTransaction(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"sendTx",value:function(){var t=Object(i.a)(c.a.mark((function t(n){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.wallet.sendRawTransaction(v(n)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"deploy",value:function(){var t=Object(i.a)(c.a.mark((function t(n,r,a,s){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.buildDeployTx(n,r,a,s).then(function(){var t=Object(i.a)(c.a.mark((function t(n){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.sendTx(n).then((function(e){return[n,e]})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r,a){return t.apply(this,arguments)}}()}]),e}()).wallet=void 0}},[[819,1,2]]]);
//# sourceMappingURL=main.3f73cec2.chunk.js.map