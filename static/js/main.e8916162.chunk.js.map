{"version":3,"sources":["lib/index.ts","lib/util.ts","state/state.ts","state/action.ts","hooks.js","App.js","reportWebVitals.js","index.js","web3/wallet.ts","web3/wutils.ts","web3/localwallet.ts","web3/web3.ts"],"names":["getSensibleApiPrefix","network","test","NetWork","Mainnet","isSensibleSuccess","res","code","msg","sleep","ms","Promise","resolve","setTimeout","formatValue","value","decimal","isValidAddress","address","bsv","Address","_","generateKeysFromEmailPassword","email","pass","Testnet","s","length","regchars","match","regupchars","regnums","bufferS","Buffer","from","crypto","Hash","sha256","i","tmp","toString","hex","privateKey","PrivateKey","toAddress","publicKey","toPublicKey","getSensibleFtHistoryUrl","genesis","codehash","getWocAddressUrl","url","getWocTransactionUrl","txid","getAddressSensibleFtList","a","apiPrefix","axios","get","data","map","item","tokenName","name","tokenSymbol","symbol","tokenDecimal","balance","pendingBalance","Error","getAddressBsvUtxoList","page","cursor","txId","outputIndex","vout","satoshis","satoshi","getAddressBsvBalanceByUtxo","sum","utxoList","reduce","prev","cur","broadcastSensibleQeury","rawtx","apiPrefx","post","txHex","Transaction","hash","transferSensibleFt","signers","senderWif","receivers","SensibleFT","selectSigners","selectRes","ft","purse","feeb","signerSelecteds","console","log","transfer","tx","txParseRes","parseTransaction","serialize","outputs","errMsg","isBsvAmountExceed","indexOf","isFtUtxoAmountExceed","error","mergeBsvUtxo","merge","ownerWif","Signature","sighashType","SIGHASH_ALL","SIGHASH_FORKID","unlockP2PKHInput","inputIndex","sigtype","sig","prevTxId","inputs","signature","Sighash","sign","output","script","satoshisBN","setScript","Script","buildPublicKeyHashIn","toDER","transferBsv","totalOutput","util","amount","utxoValue","selectedUtxoList","feePerKb","dust","utxoResList","push","addInput","Input","PublicKeyHash","Output","buildPublicKeyHashOut","empty","forEach","to","change","getFee","clearOutputs","index","utxolist","getGenesis","txidBuf","reverse","indexBuf","alloc","writeUInt32LE","toHex","concat","hasProtoFlag","scriptBuffer","protoHeader","compare","parseTokenContractScript","scriptBuf","hasSensibleFlag","dataPart","tokenProto","tokenAddress","tokenID","getCodeHash","err","message","input","ftToken","toBuffer","ret","addr","tokenAmount","isFt","ftDetail","decimalNum","div","biga","BigNumber","multi","multipliedBy","plus","minus","getDecimalString","pow","defaultSatotx","satotxApiPrefix","satotxPubKey","initialState","account","key","bsvBalance","sensibleFtList","satotxConfigMap","Map","set","createGlobalState","useGlobalState","getGlobalState","setGlobalState","accountStorageKey","saveAccountStorage","str","JSON","stringify","localStorage","setItem","getAccountStorage","getItem","parse","pollingBsvTimer","pollingSensibleFtTimer","pollingBsvBalance","clearInterval","fn","window","setInterval","pollingSensibleFtBalance","saveAccount","password","top","hashdata","decodeURIComponent","location","substr","postMsg","createPostMsg","id","preAccount","preBsvBalance","preSensibleFtBalance","accountKey","emit","type","isBsvBalanceEqual","b1","b2","isSensibleFtBalanceEqual","sort","item1","item2","localeCompare","isAccountEqual","requestLatestData","latestAccount","latestBalance","equal","handleRequest","method","on","eventData","requestId","params","response","signed","useOnceCall","cb","condition","isCalledRef","useRef","useEffect","current","Option","Select","Header","useState","decodeModalVisible","setDecodeModalVisible","setRawtx","setNetwork","resultModalVisible","setResultModalVisible","className","title","content","onClick","actions","open","visible","onCancel","TextArea","rows","onChange","e","target","style","width","placeholder","LoginPanel","Form","useForm","form","bordered","layout","onFinish","Modal","confirm","href","rel","onOk","getFieldsValue","Item","rules","required","prefix","UserOutlined","min","transform","trim","Password","LockOutlined","visibilityToggle","label","htmlType","AccountInfoPanel","onWithDraw","onTransfer","handleTransfer","margin","justify","span","itemLayout","dataSource","renderItem","placement","Meta","description","height","display","alignItems","TransferPanel","initReceivers","onTransferCallback","loading","setLoading","canEdit","isBsv","token","find","setFieldsValue","receiverList","formatBalance","handleSubmit","totalOutputValueFloatDuck","totalOutputValue","formatReceiverList","broadcastBsv","transferRes","success","broadcastSensibleFt","LeftOutlined","fontWeight","List","fields","add","remove","fieldKey","restField","marginBottom","align","validator","reject","disabled","size","shape","icon","MinusOutlined","PlusOutlined","block","App","trasfering","setTransfering","trasferSensibleFtGenesis","setTrasferSensibleFtGenesis","setInitReceivers","getHashData","opener","handlePopResponseCallback","resObj","requestAccountCondition","transferBsvCondition","outputTotal","obu","onbeforeunload","event","overflow","accountName","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById","SignType","wallet","this","signInput","sigHashType","utxo","txHash","toBsvTx","tx_","sequenceNumber","sequence","fromHex","addOutput","nLockTime","toRawTx","LocalWallet","API_PREFIX","privKey","fromWIF","fromRandom","permissions","timeout","confirmed","unconfirmed","signTx","toASM","rawTx","Math","max","time","txhex","minAmount","options","filter","tx_hash","tx_pos","FEE","web3","contractClass","buildContractClass","types","buildTypeClasses","contract","amountInContract","alicePrivateKey","bobPrivateKey","aliceWallet","bobWallet","getRawChangeAddress","aliceChangeAddress","bobChangeAddress","lockingScript","listUnspent","purpose","utxos","changeAmount","signRawTransaction","ALL","unlockscript","sendRawTransaction","buildDeployTx","sendTx"],"mappings":"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","file":"static/js/main.e8916162.chunk.js","sourcesContent":["import { bsv, toHex } from 'scryptlib';\nimport { NetWork } from '../web3';\nimport {Key, SensibleFt, SensibleSatotx, TransferReceiver, BsvUtxo} from '../state/stateType'\nimport axios from 'axios'\nimport {SensibleFT} from 'sensible-sdk'\nimport * as tokenProto from 'sensible-sdk/dist/bcp02/tokenProto'\nimport * as protoHeader from 'sensible-sdk/dist/bcp02/protoheader'\nimport { getCodeHash } from 'sensible-sdk/dist/common/utils';\nimport * as util from './util'\n\nfunction getSensibleApiPrefix(network: NetWork) {\n    const test = network === NetWork.Mainnet ? '' : '/test'\n    return `https://api.sensiblequery.com${test}`\n}\nfunction isSensibleSuccess(res: any) {\n    return res.code === 0 && res.msg === 'ok'\n}\n\nfunction sleep(ms: number) {\n    return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport function formatValue(value: number, decimal: number) {\n    // const bigNum = bsv.crypto.BN.fromNumber(value)\n    // return bigNum.div(10**decimal).toString(10)\n    return value / (10**decimal)\n}\n\nexport function isValidAddress(network: NetWork, address: string) {\n    try {\n        new bsv.Address(address, network)\n        return true\n    } catch (_) {\n        return false\n    }\n}\n\nexport function generateKeysFromEmailPassword(email: string, pass: string, network: NetWork = NetWork.Testnet): Key {\n    let s: string = email\n    s += '|'+pass+'|';\n    s += s.length+'|!@'+((pass.length*7)+email.length)*7;\n    var regchars = (pass.match(/[a-z]+/g)) ? pass.match(/[a-z]+/g)!.length : 1;\n    var regupchars = (pass.match(/[A-Z]+/g)) ? pass.match(/[A-Z]+/g)!.length : 1;\n    var regnums = (pass.match(/[0-9]+/g)) ? pass.match(/[0-9]+/g)!.length : 1;\n    s += ((regnums+regchars)+regupchars)*pass.length+'3571';\n    s += (s+''+s);\n\n    let bufferS = Buffer.from(s)\n    bufferS = bsv.crypto.Hash.sha256(bufferS)\n\tfor(let i=0;i<=49;i++){\n        const tmp = Buffer.from(bufferS.toString('hex'))\n        bufferS = bsv.crypto.Hash.sha256(tmp)\n\t}\n    const hex = bsv.crypto.Hash.sha256(Buffer.from(bufferS.toString('hex'))).toString('hex')\n    \n    const privateKey = new bsv.PrivateKey(hex, network)\n    const address = privateKey.toAddress(network).toString()\n    \n    return {\n        address,\n        privateKey: privateKey.toString(),\n        publicKey: privateKey.toPublicKey().toString()\n    }\n}\n\nexport function getSensibleFtHistoryUrl(network: NetWork, address: string, genesis: string, codehash: string) {\n    // https://sensiblequery.com/#/ft/utxo/a1961d0c0ab39f1bd0f79c2f6ae27138cca0620c/d4266deb03b5fdb7c9af39fa71f86f4b1f6390422e9bcd1556399a3f0063965f00000000/1111111111111111111114oLvT2\n    const test = network === NetWork.Mainnet ? '' : '/test'\n    return `https://sensiblequery.com${test}/#/ft/utxo/${codehash}/${genesis}/${address}`\n}\n\n\nexport function getWocAddressUrl(network: NetWork, address: string) {\n    let url = ''\n    if (network === NetWork.Mainnet) {\n        url = 'https://whatsonchain.com/address/'\n    } \n    if (network === NetWork.Testnet) {\n        url = 'https://test.whatsonchain.com/address/'\n    }\n    if (!url) {\n        return url\n    }\n    url += address\n    return url\n}\n\nexport function getWocTransactionUrl(network: NetWork, txid: string) {\n    let url = ''\n    if (network === NetWork.Mainnet) {\n        url = 'https://whatsonchain.com/tx/'\n    } \n    if (network === NetWork.Testnet) {\n        url = 'https://test.whatsonchain.com/tx/'\n    }\n    if (!url) {\n        return url\n    }\n    url += txid\n    return url\n}\n\n// todo 分页获取\nexport async function getAddressSensibleFtList(network: NetWork, address: string): Promise<SensibleFt[]> {\n    // todo remove next line\n    const apiPrefix = getSensibleApiPrefix(network)\n    const {data} = await axios.get(`${apiPrefix}/ft/summary/${address}?cursor=0&size=20`)\n    const success = isSensibleSuccess(data)\n\n    if (success) {\n        return (data.data || []).map((item: any) => {\n            return {\n                genesis: item.genesis,\n                codehash: item.codehash,\n                tokenName: item.name,\n                tokenSymbol: item.symbol,\n                tokenDecimal: item.decimal,\n                balance: item.balance + item.pendingBalance,\n            }\n        })\n    }\n    throw new Error(data.msg)\n}\n\n// 获取 bsv utxo\nexport async function getAddressBsvUtxoList(network: NetWork, address: string, page: number): Promise<BsvUtxo[]> {\n    const pageSize = 16\n    const cursor = (page - 1) * pageSize\n    const apiPrefix = getSensibleApiPrefix(network)\n    const {data} = await axios.get(`${apiPrefix}/address/${address}/utxo?cursor=${cursor}&size=${pageSize}`)\n    const success = isSensibleSuccess(data)\n    if (success) {\n        return (data.data || []).map((item: any) => {\n            return {\n                txId: item.txid, \n                outputIndex: item.vout,\n                satoshis: item.satoshi,\n                address: address,\n            }\n        })\n    }\n    throw new Error(data.msg)\n}\n\n// 获取bsv 余额, 这里加入了ft utxo的值，暂时不能用\nexport async function getAddressBsvBalance(network: NetWork, address: string): Promise<number> {\n    const apiPrefix = getSensibleApiPrefix(network)\n    const {data} = await axios.get(`${apiPrefix}/address/${address}/balance`)\n    const success = isSensibleSuccess(data)\n    if (success) {\n        return data.data.satoshi + data.data.pendingSatoshi\n    }\n    throw new Error(data.msg)\n}\n\nexport async function getAddressBsvBalanceByUtxo(network: NetWork, address: string): Promise<number> {\n    let page = 1\n    let sum = 0\n    for (;;) {\n        const utxoList = await getAddressBsvUtxoList(network, address, page)\n        sum = utxoList.reduce((prev, cur) => prev + cur.satoshis, sum)\n        if (utxoList.length === 0) {\n            break\n        }\n        page++\n    }\n    return sum\n}\n\n// 获取 sensible ft 余额\nexport async function getAddressSensibleFtBalance(network: NetWork, address: string, codehash: string, genesis: string): Promise<number> {\n    const apiPrefix = getSensibleApiPrefix(network)\n    const {data} = await axios.get(`${apiPrefix}/ft/balance/${codehash}/${genesis}/${address}`)\n    const success = isSensibleSuccess(data)\n    if (success) {\n        return data.data.satoshi\n    }\n    throw new Error(data.msg)\n}\n\n// 获取 sensible 余额 地址\nexport async function getSensibleAddressUrl(network: NetWork, address: string, codehash: string, genesis: string) {\n    const test = network === NetWork.Mainnet ? '' : '/test'\n    // https://sensiblequery.com/#/ft/utxo/ac939f3cf7aba022d09f05e5448f1e635c81dbb3/598d220eaecb68cf783cbc6cc6295d042897874f/1FJCX1QG7KyaHpx1U2iVe4xoAWNVB1Wd3L\n    return `https://sensiblequery.com${test}/#/ft/utxo/${codehash}/${genesis}/${address}`\n}\n\n\n// 广播交易\nexport async function broadcastSensibleQeury(network: NetWork, rawtx: string) {\n    const apiPrefx = getSensibleApiPrefix(network)\n    const {data} = await axios.post(`${apiPrefx}/pushtx`, {\n        txHex: rawtx,\n    })\n    const success = isSensibleSuccess(data)\n    if (success) {\n        return new bsv.Transaction(rawtx).hash\n    }\n    return new Error(data.msg)\n}\n\n\n// 发送 token 交易\nexport async function transferSensibleFt(network: NetWork, signers: SensibleSatotx[], senderWif: string, receivers: TransferReceiver[], codehash: string, genesis: string){\n    const selectRes = await SensibleFT.selectSigners()\n    const ft = new SensibleFT({\n        network: network as any,\n        purse: senderWif,\n        feeb: 0.5,\n        signerSelecteds: selectRes.signerSelecteds,\n        signers: selectRes.signers,\n    })\n    console.log('transferSensibleFt', receivers, network, codehash, genesis)\n\n    try {\n        const {txid, tx} = await ft.transfer({\n            senderWif: senderWif,\n            receivers,\n            codehash,\n            genesis,\n        })\n        const txParseRes = parseTransaction(network, tx.serialize(true))\n        return {\n            txid,\n            outputs: txParseRes.outputs,\n        }\n    } catch (err) {\n        const errMsg = err.toString();\n        const isBsvAmountExceed =\n          errMsg.indexOf(\n            \"The count of utxos should not be more than 3 in transfer\"\n          ) > 0;\n        let isFtUtxoAmountExceed = errMsg.indexOf('Too many token-utxos') > 0;\n        console.log(\"broadcast sensible ft error \");\n        console.error(err);\n\n        if (!isBsvAmountExceed && !isFtUtxoAmountExceed) {\n            throw err;\n        }\n\n        // 如果 bsv utxo 先 merge bsv utxo\n        if (isBsvAmountExceed) {\n            try {\n                await mergeBsvUtxo(network, senderWif)\n                await sleep(3000)\n            } catch (err) {\n                console.log('merge bsv utxo fail')\n                console.error(err)\n                \n            }\n\n            // merge 后重新发起 ft transfer 交易\n            try {\n                const {txid, tx} = await ft.transfer({\n                    senderWif: senderWif,\n                    receivers,\n                    codehash,\n                    genesis,\n                })\n                const txParseRes = parseTransaction(network, tx.serialize(true))\n                return {\n                    txid,\n                    outputs: txParseRes.outputs,\n                }\n            } catch (err) {\n                console.log('ft transfer fail after bsv utxo merge')\n                console.error(err)\n                const errMsg = err.toString()\n                isFtUtxoAmountExceed = errMsg.indexOf('Too many token-utxos') > 0;\n                if (!isFtUtxoAmountExceed) {\n                    throw err\n                }\n            }\n        }\n\n        if (isFtUtxoAmountExceed) {\n            // merge utxo\n            try {\n                await ft.merge({\n                    ownerWif: senderWif,\n                    codehash,\n                    genesis,\n                })\n                await sleep(3000)\n            } catch (err) {\n                console.log('merge ft utxo fail')\n                console.error(err)\n                throw err\n            }\n\n            // merge 后重新发起 ft transfer 交易\n            try {\n                const {txid, tx} = await ft.transfer({\n                    senderWif: senderWif,\n                    receivers,\n                    codehash,\n                    genesis,\n                })\n                const txParseRes = parseTransaction(network, tx.serialize(true))\n                return {\n                    txid,\n                    outputs: txParseRes.outputs,\n                }\n            } catch (err) {\n                console.log('ft transfer fail after ft utxo merge')\n                console.error(err)\n                throw err\n            }\n        }\n\n    } \n}\n\nconst Signature = bsv.crypto.Signature;\nexport const sighashType = Signature.SIGHASH_ALL | Signature.SIGHASH_FORKID;\n\n\n// p2pkh 解锁\nexport function unlockP2PKHInput(privateKey: bsv.PrivateKey, tx: bsv.Transaction, inputIndex: number, sigtype: number) {\n    const sig = new bsv.Transaction.Signature({\n      publicKey: privateKey.publicKey,\n      prevTxId: tx.inputs[inputIndex].prevTxId,\n      outputIndex: tx.inputs[inputIndex].outputIndex,\n      inputIndex,\n      signature: bsv.Transaction.Sighash.sign(\n        tx,\n        privateKey,\n        sigtype,\n        inputIndex,\n        tx.inputs[inputIndex].output.script,\n        tx.inputs[inputIndex].output.satoshisBN\n      ),\n      sigtype,\n    });\n  \n    tx.inputs[inputIndex].setScript(\n      bsv.Script.buildPublicKeyHashIn(\n        sig.publicKey,\n        sig.signature.toDER(),\n        sig.sigtype\n      )\n    );\n  }\n\n// 发送 bsv 交易\nexport async function transferBsv(network: NetWork, senderWif: string, receivers: TransferReceiver[]) {\n    // 1. 获取用户 utxo 列表\n    // 2. 判断 utxo 金额 是否 满足 receivers 金额\n    // 3. 构造交易\n    // 4. 广播交易\n    console.log('arguments', network, senderWif, receivers)\n    const address = new bsv.PrivateKey(senderWif, network).toAddress(network)\n    const balance = await getAddressBsvBalanceByUtxo(network, address)\n    const totalOutput = receivers.reduce((prev: any, cur) => util.plus(prev, cur.amount), 0)\n    if (balance < +totalOutput) {\n        throw new Error('Insufficient_Balance')\n    }\n    let utxoValue: number | string = 0\n    let selectedUtxoList = []\n\n    const tx = new bsv.Transaction()\n    tx.feePerKb(500)\n    const dust = 456\n\n    // input = output + fee + change\n    // 异常情况: 加上 change 后, fee 增加, 原本 input 不够了, 此时将所有输出移除, 然后，暂不考虑\n    \n    for (let page = 1; ;page++) {\n        const utxoResList = await getAddressBsvUtxoList(network, address, page)\n        for (let i = 0; i < utxoResList.length; i++) {\n            const item = utxoResList[i]\n            utxoValue = util.plus(utxoValue, item.satoshis)\n            selectedUtxoList.push(item)\n            tx.addInput(\n                new bsv.Transaction.Input.PublicKeyHash({\n                    output: new bsv.Transaction.Output({\n                        script: bsv.Script.buildPublicKeyHashOut(item.address),\n                        satoshis: item.satoshis,\n                    }),\n                    prevTxId: item.txId,\n                    outputIndex: item.outputIndex,\n                    script: bsv.Script.empty(),\n                })\n            );\n            if (+totalOutput <= +utxoValue) {\n                break\n            }\n        }\n        if (+totalOutput <= +utxoValue) {\n            break\n        }\n        if (utxoResList.length <= 0 ) {\n            break\n        }\n    }\n    receivers.forEach(item => {\n        tx.to(item.address, +item.amount)\n    })\n    if (+util.minus(utxoValue, +totalOutput) > 0) {\n        tx.change(address)\n    }\n    if (+util.minus(util.plus(utxoValue, tx.getFee(), dust), +totalOutput) > 0) {\n        // 全部转出\n        tx.clearOutputs()\n        receivers.forEach((item, index) => {\n            \n            if (receivers.length === index + 1) {\n                // 最后一个使用 change\n                tx.change(item.address)\n            } else {\n                tx.to(item.address, +item.amount)\n            }\n        })\n    }\n    tx.inputs.forEach((_: any, inputIndex: number) => {\n        const privateKey = new bsv.PrivateKey(senderWif)\n        unlockP2PKHInput(privateKey, tx, inputIndex, sighashType);\n    });\n    const txid = await broadcastSensibleQeury(network, tx.serialize())\n    const txParseRes = parseTransaction(network, tx.serialize(true))\n    return {\n        txid,\n        outputs: txParseRes.outputs,\n    }\n}\n\n// 合并 bsv utxo, 合并一页\nexport async function mergeBsvUtxo(network: NetWork, senderWif: string) {\n    const address = new bsv.PrivateKey(senderWif, network).toAddress(network)\n    const utxolist = await getAddressBsvUtxoList(network, address, 1)\n    const tx = new bsv.Transaction()\n    tx.feePerKb(500)\n    utxolist.forEach(item => {\n        tx.addInput(new bsv.Transaction.Input.PublicKeyHash({\n            output: new bsv.Transaction.Output({\n                script: bsv.Script.buildPublicKeyHashOut(item.address),\n                satoshis: item.satoshis,\n            }),\n            prevTxId: item.txId,\n            outputIndex: item.outputIndex,\n            script: bsv.Script.empty(),\n        }))\n    })\n    tx.change(address)\n    tx.inputs.forEach((_: any, inputIndex: number) => {\n        const privateKey = new bsv.PrivateKey(senderWif)\n        unlockP2PKHInput(privateKey, tx, inputIndex, sighashType)\n    })\n    const txid = await broadcastSensibleQeury(network, tx.serialize())\n    const txParseRes = parseTransaction(network, tx.serialize(true))\n    return {\n        txid,\n        outputs: txParseRes.outputs,\n    }\n}\n\n// 合并 sensible ft\nexport async function mergeSensibleFt(network: NetWork) {}\n\nconst getGenesis = function (txid: string, index: number) {\n    const txidBuf = Buffer.from(txid, \"hex\").reverse();\n    const indexBuf = Buffer.alloc(4, 0);\n    indexBuf.writeUInt32LE(index);\n    return toHex(Buffer.concat([txidBuf, indexBuf]));\n};\n\nconst hasProtoFlag = function (scriptBuffer: any) {\n    const flag = protoHeader.getFlag(scriptBuffer);\n    if (flag.compare(protoHeader.PROTO_FLAG) === 0) {\n      return true;\n    }\n    return false;\n};\n\n\nconst parseTokenContractScript = function (scriptBuf: any, network: any = \"mainnet\") {\n    const hasSensibleFlag = hasProtoFlag(scriptBuf);\n    if (!hasSensibleFlag) {\n      return null;\n    }\n    const dataPart = tokenProto.parseDataPart(scriptBuf);\n    const tokenAddress = new bsv.Address(\n      Buffer.from(dataPart.tokenAddress!, \"hex\"),\n      network\n    ).toString();\n    const genesis = getGenesis(dataPart.tokenID!.txid, dataPart.tokenID!.index);\n    const codehash = getCodeHash(new bsv.Script(scriptBuf));\n    return {\n      ...dataPart,\n      genesis,\n      codehash,\n      tokenAddress,\n    };\n};\n\n\n\nexport function parseTransaction(network: NetWork, rawtx: string) {\n    let tx\n    try {\n        tx = new bsv.Transaction(rawtx)\n    } catch (err) {\n        return {\n            error: err.message\n        }\n    }\n\n    const inputs = tx.inputs.map((input: any, index: number) => {\n        const ftToken: any = parseTokenContractScript(input.script.toBuffer(), network);\n\n        let ret: any = {\n            index: index,\n            prevTxId: input.prevTxId.toString('hex'),\n            outputIndex: input.outputIndex,\n            script: input.script.toString('hex'),\n        }\n        try {\n            const addr = input.script.toAddress(network);\n            if (addr) {\n                ret.address = addr.toString()\n            }\n        } catch (err) {}\n        if (!ftToken) {\n            return ret\n        }\n        if (ftToken.tokenAmount <= 0) {\n            return ret\n        }\n        ret = {\n            ...ret,\n            isFt: true,\n            ftDetail: {\n                genesis: ftToken.genesis,\n                codehash: ftToken.codehash,\n                address: ftToken.tokenAddress,\n                decimal: ftToken.decimalNum,\n                name: ftToken.tokenName,\n                symbol: ftToken.tokenSymbol,\n            }\n        }\n        return ret\n    })\n    const outputs = tx.outputs.map((output: any, index: number) => {\n        const ftToken: any = parseTokenContractScript(output.script.toBuffer(), network);\n        let ret: any = {\n            index: index,\n            satoshis: output.satoshis,\n            script: output.script.toString('hex')\n        }\n        try {\n            const addr = output.script.toAddress(network);\n            if (addr) {\n                ret.address = addr.toString()\n            }\n        } catch (err) {}\n        if (!ftToken) {\n            return ret\n        }\n        if (ftToken.tokenAmount <= 0) {\n            return ret\n        }\n        ret = {\n            ...ret,\n            isFt: true,\n            ftDetail: {\n                genesis: ftToken.genesis,\n                codehash: ftToken.codehash,\n                address: ftToken.tokenAddress,\n                decimal: ftToken.decimalNum,\n                name: ftToken.tokenName,\n                symbol: ftToken.tokenSymbol,\n                amount: ftToken.tokenAmount,\n            }\n        }\n        return ret\n    })\n\n    return {\n        inputs: inputs,\n        outputs: outputs,\n        txid: tx.hash,\n    }\n    \n}","import BigNumber from \"bignumber.js\";\n\n// 最大是253，那么全部用 string 吧\ntype NumberDuck = number | string\n\nexport function div (a: NumberDuck, ...others: NumberDuck[]): NumberDuck {\n    let biga = new BigNumber(a)\n    for (let i = 0; i < others.length; i++) {\n        biga = biga.div(new BigNumber(others[i]))\n    }\n    return biga.toString()\n}\n\nexport function multi(a: NumberDuck,  ...others: NumberDuck[]): NumberDuck {\n    let biga = new BigNumber(a)\n    for (let i = 0; i < others.length; i++) {\n        biga = biga.multipliedBy(new BigNumber(others[i]))\n    }\n    return biga.toString()\n}\n\nexport function plus(a: NumberDuck,  ...others: NumberDuck[]): NumberDuck {\n    let biga = new BigNumber(a)\n    for (let i = 0; i < others.length; i++) {\n        biga = biga.plus(new BigNumber(others[i]))\n    }\n    return biga.toString()\n}\n\nexport function minus(a: NumberDuck,  ...others: NumberDuck[]): NumberDuck {\n    let biga = new BigNumber(a)\n    for (let i = 0; i < others.length; i++) {\n        biga = biga.minus(new BigNumber(others[i]))\n    }\n    return biga.toString()\n}\n\nexport function getDecimalString(decimalNum: number): string {\n    return new BigNumber(10).pow(decimalNum).toString()\n}\n\n// 传过来 string/int -> 显示(float) -> bigint\n","import { createGlobalState } from \"react-hooks-global-state\";\nimport {State, SensibleSatotx} from './stateType'\n\nconst defaultSatotx: SensibleSatotx = {\n    satotxApiPrefix: 'https://api.satotx.com', \n    satotxPubKey: '25108ec89eb96b99314619eb5b124f11f00307a833cda48f5ab1865a04d4cfa567095ea4dd47cdf5c7568cd8efa77805197a67943fe965b0a558216011c374aa06a7527b20b0ce9471e399fa752e8c8b72a12527768a9fc7092f1a7057c1a1514b59df4d154df0d5994ff3b386a04d819474efbd99fb10681db58b1bd857f6d5'\n}\n\n// app state\nconst initialState: State = {\n    account: null,\n    key: null,\n    bsvBalance: null,\n    sensibleFtList: [],\n    satotxConfigMap: new Map()\n};\ninitialState.satotxConfigMap.set(\n    '5b3bfa8e7600d701e70551075573ea28fd16c25a39fe2bdafdc3e08b11ca76b800000000', \n    [defaultSatotx, defaultSatotx, defaultSatotx]\n)\nconst { useGlobalState, getGlobalState, setGlobalState } = createGlobalState(initialState);\n\nexport {\n    useGlobalState,\n    getGlobalState,\n    setGlobalState,\n    defaultSatotx,\n}\n","import {setGlobalState, getGlobalState } from './state'\nimport {generateKeysFromEmailPassword, getAddressSensibleFtList, getAddressBsvBalanceByUtxo} from '../lib'\nimport {Account, BalanceBsv, Key, SensibleFt} from './stateType'\nimport * as createPostMsg from 'post-msg';\n\n// local account storage\nconst accountStorageKey = 'accountStorageKey'\n// localStorage.removeItem(accountStorageKey)\nfunction saveAccountStorage(account: Account | null) {\n    const str = account ? JSON.stringify(account) : ''\n    localStorage.setItem(accountStorageKey, str)\n    // do not save account !!!\n}\nfunction getAccountStorage(): Account | null {\n    const str = localStorage.getItem(accountStorageKey)\n    if (!str) {\n        return null\n    }\n    return JSON.parse(str)\n}\n\n// app action\nlet pollingBsvTimer = 0\nlet pollingSensibleFtTimer = 0\nexport async function pollingBsvBalance(){\n    clearInterval(pollingBsvTimer)\n    const fn = async () => {\n        const account = getGlobalState('account')\n        const key = getGlobalState('key')\n        if (!account || !key) {\n            return\n        }\n        try {\n            const balance = await getAddressBsvBalanceByUtxo(account.network, key.address)\n            setGlobalState('bsvBalance', {balance})\n        } catch (err) {\n            console.log('getAddressBsvBalance err', account.network, key.address, err)\n        }\n    }\n    await fn()\n    pollingBsvTimer = window.setInterval(fn, 5000)\n}\nexport async function pollingSensibleFtBalance() {\n    clearInterval(pollingSensibleFtTimer)\n    const fn = async () => {\n        const account = getGlobalState('account')\n        const key = getGlobalState('key')\n        if (!account || !key) {\n            return\n        }\n        try {\n            const sensibleFtList = await getAddressSensibleFtList(account.network, key.address)\n            setGlobalState('sensibleFtList', sensibleFtList)\n        } catch (err) {\n            console.log('getAddressSensibleFtList err', account.network, key.address, err)\n        }\n    }\n    await fn()\n    pollingSensibleFtTimer = window.setInterval(fn, 5000)\n}\n\nexport async function saveAccount(account: Account | null) {\n    saveAccountStorage(account)\n    if (account) {\n        const key = generateKeysFromEmailPassword(account.email, account.password, account.network)\n        setGlobalState('account', account)\n        setGlobalState('key', key)\n        await pollingSensibleFtBalance()\n        pollingBsvBalance()\n    } else {\n        setGlobalState(\"account\", null)\n        setGlobalState('key', null)\n    }\n}\n\nexport function recoverAccountFromStorage() {\n    const account = getAccountStorage()\n    saveAccount(account)\n}\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms))\n\n// iframe action\nexport async function runIframeTask() {\n    if (window === window.top) {\n        return\n    }\n    const hashdata = JSON.parse(decodeURIComponent(window.location.hash.substr(1)))\n    const postMsg = createPostMsg(window.top, '*')\n    const id = hashdata.id\n\n    let preAccount: Account | null = null\n    let preBsvBalance: BalanceBsv | null = null\n    let preSensibleFtBalance: SensibleFt[] = []\n    let accountKey: Key | null = null\n    // let lastBsvBalance: \n\n    postMsg.emit(id, {\n        type: 'ready'\n    })\n\n    const isBsvBalanceEqual = (b1: BalanceBsv | null, b2: BalanceBsv | null) => {\n        if (!b1 && !b2) {\n            return true\n        }\n        return b1?.balance === b2?.balance\n    }\n    const isSensibleFtBalanceEqual = (b1: SensibleFt[], b2: SensibleFt[]) => {\n        if (b1.length !== b2.length) {\n            return false\n        }\n        b1.sort((item1, item2) => item1.genesis.localeCompare(item2.genesis))\n        b2.sort((item1, item2) => item1.genesis.localeCompare(item2.genesis))\n\n        for (let i = 0; i < b1.length; i++) {\n            const item1 = b1[i]\n            const item2 = b2[i]\n            if (item1.genesis !== item2.genesis) {\n                return false\n            }\n            if (item1.balance !== item2.balance) {\n                return false\n            }\n        }                \n        return true\n    }\n    const isAccountEqual = (b1: Account | null, b2: Account | null) => {\n        return (\n            b1?.email === b2?.email &&\n            b1?.network === b2?.network &&\n            b1?.password === b2?.password\n        )\n    }\n    const requestLatestData = async () => {\n        const latestAccount = getAccountStorage()\n        if (!(isAccountEqual(latestAccount, preAccount))) {\n            postMsg.emit(id, {\n                type: 'account',\n                data: latestAccount\n            })\n        }\n        preAccount = latestAccount;\n        if (preAccount) {\n            // get balance\n            accountKey = generateKeysFromEmailPassword(preAccount.email, preAccount.password, preAccount.network)\n            try {\n                const latestBalance = await getAddressBsvBalanceByUtxo(preAccount.network, accountKey.address)\n                const equal = isBsvBalanceEqual(preBsvBalance, {balance: latestBalance})\n                preBsvBalance = {balance: latestBalance}\n                if (!equal) {\n                    postMsg.emit(id, {\n                        type: 'bsvBalance', \n                        data: preBsvBalance,\n                    })\n                }\n            } catch (err) {}\n            try {\n                const latestBalance = await getAddressSensibleFtList(preAccount.network, accountKey.address)\n                const equal = isSensibleFtBalanceEqual(preSensibleFtBalance, latestBalance)\n                preSensibleFtBalance = latestBalance\n                if (!equal) {\n                    postMsg.emit(id, {\n                        type: 'sensibleFtBalance',\n                        data: preSensibleFtBalance\n                    })\n                }\n            } catch (err) {}\n            return true\n        } else {\n            return false\n        }\n    }\n\n    const handleRequest = (method: string, fn: Function) => {\n        postMsg.on(id, async function (_: any, eventData: any) {\n            const {type, data} = eventData\n            if (type === 'request' && data?.method === method) {\n                const requestId = data.requestId\n                try {\n                    const res = await fn(data.params)\n                    postMsg.emit(id, {\n                        type: 'response',\n                        data: {\n                            requestId,\n                            method,\n                            response: res,\n                        }\n                    })\n                } catch (err) {\n                    postMsg.emit(id, {\n                        type: 'response',\n                        data: {\n                            requestId,\n                            method,\n                            error: err.toString()\n                        }\n                    })\n                }\n            }\n        })\n    }\n\n    handleRequest('getAccount', async () => {\n        await requestLatestData()\n        if (!preAccount) {\n            return null\n        }\n        return {\n            name: preAccount.email,\n            email: preAccount.email,\n            network: preAccount.network,\n        }\n    });\n    handleRequest('getBsvBalance', async () => {\n        await requestLatestData()\n        return preBsvBalance\n    })\n    handleRequest('getSensibleFtBalance', async () => {\n        await requestLatestData()\n        return preSensibleFtBalance\n    })\n    handleRequest('getAddress', async () => {\n        await requestLatestData()\n        if (!accountKey) {\n            return null\n        }\n        return accountKey.address\n    })\n    handleRequest('logout', async () => {\n        saveAccountStorage(null)\n    })\n    handleRequest('ping', () => {\n        return null;\n    })\n\n    for (;;) {\n        const signed = await requestLatestData()\n        await sleep(signed ? 3000 : 500)\n    }\n\n}","import { useRef, useEffect } from \"react\";\n\nexport function useInterval(callback, delay) {\n  const savedCallback = useRef();\n\n  useEffect(() => {\n    savedCallback.current = callback;\n  });\n\n  useEffect(() => {\n    function tick() {\n      savedCallback.current();\n    }\n\n    let id = setInterval(tick, delay);\n    return () => clearInterval(id);\n  }, [delay]);\n}\n\nexport function useOnceCall(cb, condition = true) {\n  const isCalledRef = useRef(false);\n  useEffect(() => {\n    if (condition && !isCalledRef.current) {\n      isCalledRef.current = true;\n      cb();\n    }\n  }, [cb, condition]);\n}\n","import {\n  Button,\n  Popover,\n  Card,\n  Form,\n  Input,\n  Select,\n  List,\n  Row,\n  Col,\n  message,\n  InputNumber,\n  Space,\n  Modal,\n} from \"antd\";\nimport {\n  UserOutlined,\n  LockOutlined,\n  MinusOutlined,\n  PlusOutlined,\n  LeftOutlined,\n} from \"@ant-design/icons\";\nimport { useState, useEffect } from \"react\";\nimport * as QRCode from \"qrcode.react\";\nimport {\n  getWocAddressUrl,\n  formatValue,\n  isValidAddress,\n  transferBsv,\n  transferSensibleFt,\n  getWocTransactionUrl,\n  getSensibleFtHistoryUrl,\n  parseTransaction,\n} from \"./lib\";\nimport * as createPostMsg from \"post-msg\";\nimport { useGlobalState, defaultSatotx } from \"./state/state\";\nimport * as actions from \"./state/action\";\nimport { useOnceCall } from \"./hooks\";\nimport \"./App.css\";\nimport * as util from \"./lib/util\";\n\nconst { Option } = Select;\n\nfunction Header() {\n  const [account] = useGlobalState(\"account\");\n  const [key] = useGlobalState(\"key\");\n  const [decodeModalVisible, setDecodeModalVisible] = useState(false);\n  const [rawtx, setRawtx] = useState(\"\");\n  const [network, setNetwork] = useState(\"\");\n  const [resultModalVisible, setResultModalVisible] = useState(false);\n\n  const handleLogout = () => {\n    actions.saveAccount(null);\n  };\n  const handleHistory = () => {\n    let url = getWocAddressUrl(account.network, key.address);\n    window.open(url);\n  };\n  const handleSourceCode = () => {\n    window.open(\"http://github.com\");\n  };\n\n  const decodeTx = () => {\n    const res = parseTransaction(network, rawtx);\n    console.log(\"decodeTx res\", res);\n  };\n\n  return (\n    <div className=\"header\">\n      <div className=\"logo\">Web Wallet</div>\n      {account && (\n        <Popover\n          title=\"\"\n          content={\n            <>\n              <Button type=\"link\" onClick={handleLogout}>\n                Logout\n              </Button>\n              <br />\n              <Button type=\"link\" onClick={handleHistory}>\n                History\n              </Button>\n              <br />\n              <Button type=\"link\" onClick={handleSourceCode}>\n                Source Code\n              </Button>\n              <br />\n              <Button type=\"link\" onClick={() => setDecodeModalVisible(true)}>\n                decode rawtx\n              </Button>\n            </>\n          }\n        >\n          <Button type=\"link\">{account.email}</Button>\n        </Popover>\n      )}\n      <Modal\n        visible={decodeModalVisible}\n        onCancel={() => setDecodeModalVisible(false)}\n      >\n        <Input.TextArea\n          rows={4}\n          value={rawtx}\n          onChange={(e) => setRawtx(e.target.value)}\n        ></Input.TextArea>\n        <Select\n          style={{ width: 180 }}\n          placeholder=\"Select network\"\n          value={network}\n          onChange={(value) => setNetwork(value)}\n        >\n          <Option value=\"mainnet\">mainnet</Option>\n          <Option value=\"testnet\">testnet</Option>\n        </Select>\n        <Button type=\"primary\" onClick={decodeTx}>\n          decode\n        </Button>\n      </Modal>\n      <Modal\n        visible={resultModalVisible}\n        onCancel={() => setResultModalVisible(false)}\n      ></Modal>\n    </div>\n  );\n}\n\nfunction LoginPanel() {\n  const [account] = useGlobalState(\"account\");\n  const [form] = Form.useForm();\n\n  const handleOnFinish = () => {\n    Modal.confirm({\n      title: \"安全注意\",\n      content: (\n        <div>\n          Web钱包的私钥是通过用户的用户名和密码实时计算得到，不会上传服务器，也不会保存在本地(代码见\n          <a\n            href=\"https://github.com/klouskingsley/bsv-web-wallet\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            github\n          </a>\n          )。仅供方便用户测试之用，不适合存放大量资金，建议用户妥善保管用户名+密码组合以防资金丢失，或在使用完成之后将剩余资金转移。用户名+密码组合丢失(忘记，被盗等情形)会导致资产丢失\n        </div>\n      ),\n      onOk: () => {\n        const account = form.getFieldsValue();\n        actions.saveAccount(account);\n      },\n    });\n  };\n  if (account) {\n    return null;\n  }\n\n  return (\n    <Card className=\"card\" title=\"Login\" bordered={false}>\n      <Form form={form} layout=\"vertical\" onFinish={handleOnFinish}>\n        <Form.Item\n          name=\"email\"\n          rules={[\n            {\n              type: \"email\",\n              required: true,\n              message: \"Please input a valid Email!\",\n            },\n          ]}\n        >\n          <Input\n            prefix={<UserOutlined className=\"site-form-item-icon\" />}\n            placeholder=\"Email\"\n          />\n        </Form.Item>\n        <Form.Item\n          name=\"password\"\n          rules={[\n            { required: true, message: \"Please input your Password!\" },\n            {\n              min: 6,\n              message: \"Password at least 6 chars\",\n              transform: (value) => value && value.trim(),\n            },\n          ]}\n        >\n          <Input.Password\n            prefix={<LockOutlined className=\"site-form-item-icon\" />}\n            type=\"password\"\n            visibilityToggle={true}\n            placeholder=\"Password\"\n          />\n        </Form.Item>\n        <Form.Item name=\"network\" label=\"Network\" rules={[{ required: true }]}>\n          <Select placeholder=\"Select network\">\n            <Option value=\"mainnet\">mainnet</Option>\n            <Option value=\"testnet\">testnet</Option>\n          </Select>\n        </Form.Item>\n        <Form.Item>\n          <Button\n            type=\"primary\"\n            htmlType=\"submit\"\n            className=\"login-form-button\"\n          >\n            Log in\n          </Button>\n        </Form.Item>\n      </Form>\n    </Card>\n  );\n}\n\nfunction AccountInfoPanel({ onWithDraw, onTransfer }) {\n  const [key] = useGlobalState(\"key\");\n  const [account] = useGlobalState(\"account\");\n  const [bsvBalance] = useGlobalState(\"bsvBalance\");\n  const [sensibleFtList] = useGlobalState(\"sensibleFtList\");\n\n  if (!key) {\n    return null;\n  }\n  const handleHistory = () => {\n    let url = getWocAddressUrl(account.network, key.address);\n    window.open(url);\n  };\n  const handleTransfer = (genesis) => {\n    if (!genesis) {\n      return onTransfer(\"\");\n    }\n    // if (!satotxConfigMap.has(genesis)) {\n    //   return message.error(\"rabin api not set or found\");\n    // }\n    return onTransfer(genesis);\n  };\n  return [\n    <Card\n      className=\"card\"\n      title=\"Account Info\"\n      bordered={false}\n      actions={\n        <>\n          <Button type=\"link\" onClick={handleHistory}>\n            history\n          </Button>\n          ,\n          <Button type=\"link\" onClick={onWithDraw}>\n            withdraw\n          </Button>\n          ,\n        </>\n      }\n    >\n      <Form layout=\"vertical\">\n        <Form.Item label={`${account.network} address`}>\n          <Input value={key.address} />\n          <div style={{ margin: 20 }}>\n            <QRCode value={key.address} />\n          </div>\n        </Form.Item>\n        <Form.Item label=\"privateKey\">\n          <Input.Password visibilityToggle={true} value={key.privateKey} />\n        </Form.Item>\n      </Form>\n    </Card>,\n    <Card className=\"card\" title=\"Asset\" bordered={false}>\n      <Form layout=\"vertical\">\n        {bsvBalance && (\n          <Form.Item label=\"BSV balance\">\n            <Row justify=\"space-between\">\n              <Col span={16}>\n                <div>{formatValue(bsvBalance.balance, 8)}</div>\n              </Col>\n              <Col span={7}>\n                <Button type=\"link\" onClick={() => handleTransfer(\"\")}>\n                  Transfer BSV\n                </Button>\n              </Col>\n            </Row>\n          </Form.Item>\n        )}\n        {sensibleFtList.length > 0 && (\n          <Form.Item label=\"Sensible Fungible Token\">\n            <List\n              itemLayout=\"horizontal\"\n              dataSource={sensibleFtList}\n              renderItem={(item) => {\n                return (\n                  <List.Item\n                    key={item.genesis}\n                    actions={\n                      <>\n                        <Popover\n                          placement=\"topRight\"\n                          content={\n                            <>\n                              <div>codehash: {item.codehash}</div>,\n                              <div>genesis: {item.genesis}</div>,\n                            </>\n                          }\n                        >\n                          <a\n                            key=\"list-loadmore-more\"\n                            href={getSensibleFtHistoryUrl(\n                              account.network,\n                              key.address,\n                              item.genesis,\n                              item.codehash\n                            )}\n                            rel=\"noreferrer\"\n                            target=\"_blank\"\n                          >\n                            more info\n                          </a>\n                        </Popover>\n                      </>\n                    }\n                  >\n                    <List.Item.Meta\n                      title={item.tokenSymbol}\n                      description={item.tokenName}\n                    />\n                    <Row>\n                      <Col>\n                        <div\n                          style={{\n                            height: \"100%\",\n                            display: \"flex\",\n                            alignItems: \"center\",\n                          }}\n                        >\n                          Balance:{\" \"}\n                          {formatValue(item.balance, item.tokenDecimal)}\n                        </div>\n                      </Col>\n                      <Col>\n                        <Button\n                          type=\"link\"\n                          onClick={() => handleTransfer(item.genesis)}\n                        >\n                          Go Transfer\n                        </Button>\n                      </Col>\n                    </Row>\n                  </List.Item>\n                );\n              }}\n            ></List>\n          </Form.Item>\n        )}\n      </Form>\n    </Card>,\n  ];\n}\n\nfunction TransferPanel({\n  genesis = \"\",\n  initReceivers = [],\n  onCancel,\n  onTransferCallback,\n}) {\n  const [key] = useGlobalState(\"key\");\n  const [bsvBalance] = useGlobalState(\"bsvBalance\");\n  const [account] = useGlobalState(\"account\");\n  const [sensibleFtList] = useGlobalState(\"sensibleFtList\");\n  const [satotxConfigMap] = useGlobalState(\"satotxConfigMap\");\n  const [form] = Form.useForm();\n  const [loading, setLoading] = useState(false);\n  const canEdit = !(initReceivers.length > 0);\n\n  useOnceCall(() => {\n    const isBsv = genesis === \"\";\n    const token = sensibleFtList.find((item) => item.genesis === genesis);\n    const decimal = isBsv ? 8 : token.tokenDecimal;\n    console.log(\n      \"initReceivers\",\n      initReceivers,\n      initReceivers.map((item) => {\n        return {\n          address: item.address,\n          amount: util.multi(item.amount, util.getDecimalString(decimal)),\n        };\n      })\n    );\n    form.setFieldsValue({\n      receiverList: initReceivers.map((item) => {\n        return {\n          address: item.address,\n          amount: util.div(item.amount, util.getDecimalString(decimal)),\n        };\n      }),\n    });\n  }, key && bsvBalance && initReceivers.length);\n\n  if (!key) {\n    return null;\n  }\n  if (!bsvBalance) {\n    return null;\n  }\n  if (genesis && !sensibleFtList.length) {\n    return null;\n  }\n\n  const isBsv = genesis === \"\";\n  const token = sensibleFtList.find((item) => item.genesis === genesis);\n\n  if (!isBsv && !token) {\n    return null;\n  }\n  const tokenSymbol = isBsv ? \"BSV\" : token.tokenSymbol;\n  const decimal = isBsv ? 8 : token.tokenDecimal;\n  const balance = isBsv ? bsvBalance.balance : token.balance;\n  const formatBalance = formatValue(balance, decimal);\n\n  const handleSubmit = async () => {\n    const { receiverList } = form.getFieldsValue();\n    const totalOutputValueFloatDuck = receiverList.reduce(\n      (prev, cur) => util.plus(prev, cur.amount),\n      0\n    );\n\n    const totalOutputValue = util.multi(\n      totalOutputValueFloatDuck,\n      util.getDecimalString(decimal)\n    );\n    if (balance < +totalOutputValue) {\n      const msg = \"Insufficient ft balance\";\n      onTransferCallback({\n        error: msg,\n      });\n      return message.error(msg);\n    }\n    const formatReceiverList = receiverList.map((item) => {\n      return {\n        address: item.address,\n        amount: util.multi(item.amount, util.getDecimalString(decimal)),\n      };\n    });\n\n    const broadcastBsv = async () => {\n      setLoading(true);\n      let txid = \"\";\n      let transferRes;\n      try {\n        const res = await await transferBsv(\n          account.network,\n          key.privateKey,\n          formatReceiverList\n        );\n        transferRes = res;\n        txid = res.txid;\n      } catch (err) {\n        const msg = \"broadcast error: \" + err.toString();\n        onTransferCallback({\n          error: msg,\n        });\n        console.log(\"broadcast bsv error \");\n        console.error(err)\n        message.error(err.toString());\n      }\n      setLoading(false);\n      if (txid) {\n        onTransferCallback({\n          response: {\n            ...transferRes,\n          },\n        });\n        Modal.success({\n          title: \"Transaction broadcast success\",\n          content: (\n            <div>\n              txid:{\" \"}\n              <a\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                href={getWocTransactionUrl(account.network, txid)}\n              >\n                {txid}\n              </a>\n            </div>\n          ),\n        });\n      }\n    };\n\n    const broadcastSensibleFt = async () => {\n      setLoading(true);\n      let txid = \"\";\n      let transferRes;\n      try {\n        const signers = satotxConfigMap.get(genesis) || [\n          defaultSatotx,\n          defaultSatotx,\n          defaultSatotx,\n        ];\n        const res = await transferSensibleFt(\n          account.network,\n          signers,\n          key.privateKey,\n          formatReceiverList,\n          token.codehash,\n          token.genesis\n        );\n        transferRes = res;\n        txid = res.txid;\n      } catch (err) {\n        console.log(\"broadcast sensible ft error \");\n        console.error(err);\n        message.error(err.toString());\n      }\n      setLoading(false);\n      if (txid) {\n        onTransferCallback({\n          response: {\n            ...transferRes,\n          },\n        });\n        Modal.success({\n          title: \"Transaction broadcast success\",\n          content: (\n            <div>\n              txid:{\" \"}\n              <a\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                href={getWocTransactionUrl(account.network, txid)}\n              >\n                {txid}\n              </a>\n            </div>\n          ),\n        });\n      }\n    };\n\n    Modal.confirm({\n      title: \"Confirm the transaction\",\n      onOk: () => {\n        isBsv ? broadcastBsv() : broadcastSensibleFt();\n      },\n    });\n  };\n  const handleBack = () => {\n    onCancel();\n  };\n\n  return (\n    <Card\n      className=\"card\"\n      title={\n        <div style={{ cursor: \"pointer\" }} onClick={handleBack}>\n          <LeftOutlined />\n          Transfer\n        </div>\n      }\n      loading={loading}\n      bordered={false}\n    >\n      <Form form={form} layout=\"vertical\" onFinish={handleSubmit}>\n        <div className=\"transfer-line\">\n          {isBsv ? `Coin: ${tokenSymbol}` : `Token: ${tokenSymbol}`}\n        </div>\n        {!isBsv && (\n          <div className=\"transfer-line\">Genesis: {token.genesis}</div>\n        )}\n        {!isBsv && (\n          <div className=\"transfer-line\">Codehash: {token.codehash}</div>\n        )}\n        <Row justify=\"space-between\" style={{ margin: \"10px 0\" }}>\n          <Col span={14}>\n            <div style={{ fontWeight: 700 }}>Input</div>\n          </Col>\n        </Row>\n        <div className=\"transfer-line\">{`Balance: ${formatBalance}`}</div>\n        <div className=\"transfer-line\">{`From Address: ${key.address}`}</div>\n        <Row justify=\"space-between\" style={{ margin: \"10px 0\" }}>\n          <Col span={14}>\n            <div style={{ fontWeight: 700 }}>Output</div>\n          </Col>\n        </Row>\n        <Form.List name=\"receiverList\">\n          {(fields, { add, remove }) => (\n            <>\n              {fields.map((key, name, fieldKey, ...restField) => {\n                return (\n                  <Space\n                    key={key.fieldKey}\n                    style={{ display: \"flex\", marginBottom: 8 }}\n                    align=\"baseline\"\n                  >\n                    <Form.Item\n                      {...restField}\n                      name={[name, \"address\"]}\n                      fieldKey={[fieldKey, \"address\"]}\n                      rules={[\n                        {\n                          required: true,\n                          message: \"Please input the address\",\n                        },\n                        {\n                          message: \"invalid address\",\n                          validator: (_, value) =>\n                            isValidAddress(account.network, value)\n                              ? Promise.resolve()\n                              : Promise.reject(),\n                        },\n                      ]}\n                    >\n                      <Input\n                        placeholder=\"Input the address\"\n                        disabled={!canEdit}\n                      />\n                    </Form.Item>\n                    <Form.Item\n                      {...restField}\n                      name={[name, \"amount\"]}\n                      fieldKey={[fieldKey, \"amount\"]}\n                      rules={[\n                        { required: true, message: \"Please input amount\" },\n                      ]}\n                    >\n                      <InputNumber\n                        placeholder=\"Amount\"\n                        min={0}\n                        disabled={!canEdit}\n                      />\n                    </Form.Item>\n                    <Button\n                      disabled={!canEdit}\n                      size=\"small\"\n                      onClick={() => remove(name)}\n                      shape=\"circle\"\n                      icon={<MinusOutlined />}\n                    />\n                  </Space>\n                );\n              })}\n\n              <Form.Item>\n                <Button\n                  type=\"dashed\"\n                  onClick={() => add()}\n                  icon={<PlusOutlined />}\n                  disabled={!canEdit}\n                >\n                  Add Output\n                </Button>\n              </Form.Item>\n            </>\n          )}\n        </Form.List>\n        <Form.Item>\n          <Button type=\"primary\" htmlType=\"submit\" block>\n            Transfer\n          </Button>\n        </Form.Item>\n      </Form>\n    </Card>\n  );\n}\n\nfunction App() {\n  useEffect(() => {\n    actions.recoverAccountFromStorage();\n  }, []);\n\n  const [trasfering, setTransfering] = useState(false);\n  const [trasferSensibleFtGenesis, setTrasferSensibleFtGenesis] = useState(\"\");\n  const [account] = useGlobalState(\"account\");\n  const [key] = useGlobalState(\"key\");\n  const [bsvBalance] = useGlobalState(\"bsvBalance\");\n  const [sensibleFtList] = useGlobalState(\"sensibleFtList\");\n  const [initReceivers, setInitReceivers] = useState([]);\n\n  const handleTransfer = (genesis) => {\n    setTransfering(true);\n    genesis && setTrasferSensibleFtGenesis(genesis);\n  };\n  const handleCancelTransfer = () => {\n    setTransfering(false);\n    setTrasferSensibleFtGenesis(\"\");\n  };\n\n  const getHashData = () => {\n    if (!window.opener) {\n      return null;\n    }\n    const hash = window.location.hash.substr(1);\n    try {\n      const data = JSON.parse(decodeURIComponent(hash));\n      if (data.type === \"popup\") {\n        if (typeof data.data === \"object\") {\n          return data;\n        }\n      }\n    } catch (err) {}\n    return null;\n  };\n  const handlePopResponseCallback = (resObj) => {\n    const data = getHashData();\n    if (!data) {\n      return;\n    }\n    const postMsg = createPostMsg(window.opener, \"*\");\n    postMsg.emit(data.id, {\n      type: \"response\",\n      data: {\n        ...data.data.data,\n        ...resObj,\n      },\n    });\n  };\n\n  // todo 数值计算 使用 bignumber\n  // todo 此处接收 postMessage 消息，处理登录,transfer\n  const requestAccountCondition = key?.address && account?.network;\n  const transferBsvCondition =\n    requestAccountCondition && bsvBalance && bsvBalance.balance >= 0;\n  useOnceCall(() => {\n    const data = getHashData();\n    if (!data || data.data.type !== \"request\") {\n      return;\n    }\n\n    const { method, params } = data.data.data;\n    if (method !== \"requestAccount\") {\n      return;\n    }\n    Modal.confirm({\n      title: \"Connect\",\n      content: (\n        <div>\n          Allow <b>{params.name}</b> to connect your web wallet\n        </div>\n      ),\n      onOk: () => {\n        handlePopResponseCallback({ response: true });\n      },\n      onCancel: () => {\n        handlePopResponseCallback({ error: \"user reject\" });\n      },\n    });\n  }, !!requestAccountCondition);\n  useOnceCall(() => {\n    const data = getHashData();\n    console.log(\"bsv hash data\", data);\n    if (!data || data.data.type !== \"request\") {\n      return;\n    }\n\n    const { method, params } = data.data.data;\n    if (method !== \"transferBsv\") {\n      return;\n    }\n    // balance check\n    const outputTotal = params.receivers.reduce(\n      (prev, cur) => util.plus(prev, cur.amount),\n      0\n    );\n    if (outputTotal > bsvBalance.balance) {\n      handlePopResponseCallback({ error: \"insufficient bsv balance\" });\n      return;\n    }\n    setTransfering(true);\n    setInitReceivers(params.receivers);\n  }, !!transferBsvCondition);\n  useOnceCall(() => {\n    const data = getHashData();\n    console.log(\"hashdata\", data);\n    if (!data || data.data.type !== \"request\") {\n      return;\n    }\n\n    const { method, params } = data.data.data;\n    if (method !== \"transferSensibleFt\") {\n      return;\n    }\n    // sensibleft balance check\n    const outputTotal = params.receivers.reduce(\n      (prev, cur) => util.plus(prev, cur.amount),\n      0\n    );\n    console.log(\"outputTotal\", outputTotal);\n    const ft = sensibleFtList.find((item) => item.genesis === params.genesis);\n    console.log(\"ft\", ft);\n    if (!ft) {\n      handlePopResponseCallback({ error: \"insufficient ft balance\" });\n      return;\n    }\n    if (+outputTotal >= +ft.balance) {\n      handlePopResponseCallback({ error: \"insufficient ft balance\" });\n      return;\n    }\n    setTransfering(true);\n    setTrasferSensibleFtGenesis(params.genesis);\n    setInitReceivers(params.receivers);\n  }, !!transferBsvCondition);\n  useEffect(() => {\n    const obu = window.onbeforeunload;\n    window.onbeforeunload = function (event) {\n      handlePopResponseCallback({ error: \"use closed\" });\n      return obu(event);\n    };\n  });\n\n  return (\n    <div className=\"App\" style={{ overflow: \"hidden\" }}>\n      <Header accountName=\"harry\" />\n      <LoginPanel />\n      {!trasfering && <AccountInfoPanel onTransfer={handleTransfer} />}\n      {trasfering && (\n        <TransferPanel\n          genesis={trasferSensibleFtGenesis}\n          onCancel={handleCancelTransfer}\n          onTransferCallback={handlePopResponseCallback}\n          initReceivers={initReceivers}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport * as actions from \"./state/action\";\n\nconst isIframe = window === window.top;\n\nif (isIframe) {\n  ReactDOM.render(\n    <React.StrictMode>\n      <App />\n    </React.StrictMode>,\n    document.getElementById(\"root\")\n  );\n} else {\n  actions.runIframeTask();\n}\n\n// delete account when page/iframe exit\n(function () {\n  const obu = window.onbeforeunload;\n  window.onbeforeunload = function (event) {\n    const isPopup = !!window.opener;\n    if (!isPopup) {\n      actions.saveAccount(null);\n    }\n    return obu(event);\n  };\n})();\n\n// alert(window === window.top);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","\nexport interface UTXO {\n  txHash: number,\n  outputIndex: string;\n  satoshis: number;\n  script: string;\n}\n\nexport interface Output {\n  satoshis: number,\n  script: string;\n}\n\n\nexport interface Input {\n  utxo: UTXO,\n  sequence: number,\n  script: string;\n}\n\nexport interface Tx {\n  nLockTime?: number,\n  inputs: Input[],\n  outputs: Output[],\n}\n\nexport interface Account {\n  name: string,\n  paymail: string,\n  address: string,\n  permissions?: string[]\n}\n\n\nexport enum NetWork {\n  Testnet = 'testnet',\n  Mainnet = 'mainnet',\n  STN = 'STN'\n}\n\n\nexport enum SignType {\n  ALL = 0x00000001 | 0x00000040,\n  SINGLE = 0x00000003 | 0x00000040,\n  NONE = 0x00000002 | 0x00000040,\n  ANYONECANPAY_ALL = 0x00000001 | 0x00000040 | 0x00000080,\n  ANYONECANPAY_SINGLE = 0x00000003 | 0x00000040 | 0x00000080,\n  ANYONECANPAY_NONE = 0x00000002 | 0x00000040 | 0x00000080\n}\n\n\nexport abstract class wallet {\n\n  network: NetWork;\n\n  constructor(network: NetWork) {\n    this.network = network;\n  }\n\n  //Dapp use this api to connect to the wallet.\n  abstract requestAccount(name: string, permissions: string[]): Promise<Account>;\n\n  //get wallet balance\n  abstract getbalance(): Promise<number>;\n\n  //sign raw transaction, returns unlockscript of the p2pkh input if success\n  abstract signRawTransaction(tx: Tx, inputIndex: number, sigHashType: SignType\n  ): Promise<string>;\n\n  //get signature for special input\n  abstract getSignature(tx: Tx, inputIndex: number, sigHashType: SignType\n  ): Promise<string>;\n\n  //send raw transaction, returns transaction hash if success\n  abstract sendRawTransaction(rawTx: string): Promise<string>;\n\n  //returns array of unspent transaction outputs, which total amount is more than the minAmount argument.\n  abstract listUnspent(minAmount: number, options?: {\n    purpose?: string\n  }): Promise<UTXO[]>;\n\n  //returns a new Bitcoin address, for receiving change.\n  abstract getRawChangeAddress(options?: {\n    purpose?: string\n  }): Promise<string>;\n\n  //returns a public key\n  abstract getPublicKey(options?: {\n    purpose?: string\n  }): Promise<string>;\n\n}","\nimport { bsv, SigHashPreimage, getPreimage as getPreimage_ } from 'scryptlib';\nimport { SignType, Tx, UTXO } from './wallet';\n\n\nexport function signInput(privateKey: any, tx: any, inputIndex: number, sigHashType: number, utxo: UTXO): string {\n\n  tx.inputs[inputIndex].output = new bsv.Transaction.Output({\n    script: utxo.script,\n    satoshis: utxo.satoshis\n  });\n\n  const sig = new bsv.Transaction.Signature({\n    publicKey: privateKey.publicKey,\n    prevTxId: utxo.txHash,\n    outputIndex: utxo.outputIndex,\n    inputIndex,\n    signature: bsv.Transaction.Sighash.sign(tx, privateKey, sigHashType,\n      inputIndex,\n      tx.inputs[inputIndex].output.script,\n      tx.inputs[inputIndex].output.satoshisBN),\n    sigtype: sigHashType,\n  });\n\n  return bsv.Script.buildPublicKeyHashIn(\n    sig.publicKey,\n    sig.signature.toDER(),\n    sig.sigtype,\n  ).toHex();\n}\n\n\n\n\nexport function toBsvTx(tx: Tx) {\n  const tx_ = new bsv.Transaction();\n\n  tx.inputs.forEach(input => {\n    tx_.addInput(new bsv.Transaction.Input({\n      prevTxId: input.utxo.txHash,\n      outputIndex: input.utxo.outputIndex,\n      sequenceNumber: input.sequence,\n      script: input.script ? bsv.Script.fromHex(input.script) : new bsv.Script(),\n    }), bsv.Script.fromHex(input.utxo.script), input.utxo.satoshis);\n  });\n\n\n  tx.outputs.forEach(output => {\n    tx_.addOutput(new bsv.Transaction.Output({\n      script: bsv.Script.fromHex(output.script),\n      satoshis: output.satoshis,\n    }));\n  });\n\n  tx_.nLockTime = tx.nLockTime || 0;\n  return tx_;\n}\n\nexport function toRawTx(tx: Tx) {\n  return toBsvTx(tx).toString();\n}\n\n\n\nexport function getPreimage(tx: Tx, inputIndex = 0, sigHashType: SignType = SignType.ALL): SigHashPreimage {\n  const bsvTx = toBsvTx(tx);\n  return getPreimage_(bsvTx, bsv.Script.fromHex(tx.inputs[inputIndex].utxo.script).toASM(), tx.inputs[inputIndex].utxo.satoshis, inputIndex, sigHashType);\n}\n","import { Account, NetWork, UTXO, wallet, Tx, SignType } from './wallet';\nimport { toHex, bsv, signTx } from 'scryptlib';\nimport { signInput, toBsvTx } from './wutils';\nimport axios from 'axios';\n\n\nexport class LocalWallet extends wallet {\n  API_PREFIX: string;\n  privKey: any;\n  constructor(network: NetWork, key: string) {\n    super(network);\n    this.API_PREFIX = `https://api.whatsonchain.com/v1/bsv/${network === NetWork.Testnet ? 'test' : 'main'}`;\n    this.privKey = key ? new bsv.PrivateKey.fromWIF(key) : new bsv.PrivateKey.fromRandom(network);\n  }\n\n\n  requestAccount(name: string, permissions: string[]): Promise<Account> {\n    throw new Error('Method not implemented.');\n  }\n\n  async getbalance(): Promise<number> {\n\n    const {\n      data: balance\n    } = await axios.get(`${this.API_PREFIX}/address/${this.privKey.toAddress()}/balance`, {\n      timeout: 5000\n    });\n\n    return balance.confirmed + balance.unconfirmed;\n  }\n\n  async signRawTransaction(tx: Tx,\n    inputIndex: number,\n    sigHashType: SignType\n  ): Promise<string> {\n\n\n    const tx_ = toBsvTx(tx);\n\n    const utxo = tx.inputs[inputIndex].utxo;\n\n    return signInput(this.privKey, tx_, inputIndex, sigHashType, utxo);\n  }\n\n\n  async getSignature(tx: Tx,\n    inputIndex: number,\n    sigHashType: SignType\n  ): Promise<string> {\n\n\n    const tx_ = toBsvTx(tx);\n\n    return signTx(tx_, this.privKey, tx_.inputs[inputIndex].output.script.toASM(), tx_.inputs[inputIndex].output.satoshisBN, inputIndex, sigHashType);\n\n  }\n\n  async sendRawTransaction(rawTx: string): Promise<string> {\n\n    // 1 second per KB\n\n    const size = Math.max(1, rawTx.length / 2 / 1024); //KB\n    const time = Math.max(10000, 1000 * size);\n    const {\n      data: txid\n    } = await axios.post(`${this.API_PREFIX}/tx/raw`, {\n      txhex: rawTx\n    }, {\n      timeout: time\n    });\n    return txid;\n  }\n\n  async listUnspent(minAmount: number, options?: { purpose?: string; }): Promise<UTXO[]> {\n    return axios.get(`${this.API_PREFIX}/address/${this.privKey.toAddress()}/unspent`, {\n      timeout: 10000\n    }).then(res => {\n      return res.data.filter((utxo: any) => utxo.value >= minAmount).map((utxo: any) => {\n        return {\n          txHash: utxo.tx_hash,\n          outputIndex: utxo.tx_pos,\n          satoshis: utxo.value,\n          script: bsv.Script.buildPublicKeyHashOut(this.privKey.toAddress()).toHex(),\n        } as UTXO;\n      });\n    });\n  }\n\n\n  getRawChangeAddress(options?: { purpose?: string; }): Promise<string> {\n\n    return new Promise(resolve => resolve(this.privKey.toAddress() + ''));\n  }\n\n\n  getPublicKey(options?: { purpose?: string; }): Promise<string> {\n\n    return new Promise(resolve => resolve(toHex(this.privKey.publicKey)));\n  }\n\n}","import { buildContractClass, buildTypeClasses, ScryptType, bsv } from 'scryptlib';\nimport { } from 'scryptlib';\nimport { UTXO, wallet, Tx,SignType, NetWork } from './wallet';\nimport axios from 'axios';\nimport { AbstractContract } from 'scryptlib/dist/contract';\nimport { toRawTx } from './wutils';\nimport { LocalWallet } from './localwallet';\nconst WEB3_VERSION = '0.0.1';\n\nconst FEE = 2000;\n\nexport class web3 {\n\n\n  static wallet: wallet;\n\n\n  static setWallet(wallet: wallet) {\n    web3.wallet = wallet;\n  }\n\n\n  static version() {\n    return WEB3_VERSION;\n  }\n\n\n  static loadContract(url: string): Promise<{\n    contractClass: typeof AbstractContract,\n    types: Record<string, typeof ScryptType>\n  }> {\n\n    return axios.get(url, {\n      timeout: 10000\n    }).then(res => {\n\n      return {\n        contractClass: buildContractClass(res.data),\n        types: buildTypeClasses(res.data)\n      };\n    });\n  }\n\n\n\n  static async buildDeployTx(contract: AbstractContract, amountInContract: number, alicePrivateKey: string, bobPrivateKey: string): Promise<Tx> {\n\n    let aliceWallet = new LocalWallet(NetWork.Mainnet, alicePrivateKey);\n    let bobWallet = new LocalWallet(NetWork.Mainnet, bobPrivateKey);\n\n    const aliceChangeAddress = await aliceWallet.getRawChangeAddress();\n    const bobChangeAddress = await bobWallet.getRawChangeAddress();\n\n    const tx: Tx = {\n      inputs: [],\n      outputs: []\n    };\n\n    tx.outputs.push({\n      script: contract.lockingScript.toHex(),\n      satoshis: amountInContract * 2\n    });\n\n    const minAmount = amountInContract + FEE;\n\n    return aliceWallet.listUnspent(minAmount, {\n      purpose: 'change'\n    }).then(async (utxos: UTXO[]) => {\n\n      if (utxos.length === 0) {\n        throw new Error('no utxos');\n      }\n\n      //add input which using utxo from alice\n      tx.inputs.push(\n        {\n          utxo: utxos[0],\n          script: '',\n          sequence: 0\n        }\n      );\n\n      const changeAmount = utxos[0].satoshis - amountInContract - FEE;\n\n      if (changeAmount <= 0) {\n        throw new Error('fund is not enough');\n      }\n\n      //add alice change output\n\n      tx.outputs.push(\n        {\n          script: bsv.Script.buildPublicKeyHashOut(aliceChangeAddress).toHex(),\n          satoshis: changeAmount\n        }\n      );\n\n      return tx;\n    }).then(tx => {\n      return bobWallet.listUnspent(minAmount, {\n        purpose: 'change'\n      }).then(async (utxos: UTXO[]) => {\n\n        if (utxos.length === 0) {\n          throw new Error('no utxos');\n        }\n\n        //add input which using utxo from bob\n        tx.inputs.push(\n          {\n            utxo: utxos[0],\n            script: '',\n            sequence: 0\n          }\n        );\n\n        const changeAmount = utxos[0].satoshis - amountInContract - FEE;\n\n        if (changeAmount <= 0) {\n          throw new Error('fund is not enough');\n        }\n\n        //add bob change output\n        tx.outputs.push(\n          {\n            script: bsv.Script.buildPublicKeyHashOut(bobChangeAddress).toHex(),\n            satoshis: changeAmount\n          }\n        );\n\n        return tx;\n\n      })\n    }).then(tx => {\n      //alice sign\n      return aliceWallet.signRawTransaction(tx, 0, SignType.ALL).then(unlockscript => {\n        tx.inputs[0].script = unlockscript;\n        return tx;\n      })\n    }).then(tx => {\n      //bob sign\n      return bobWallet.signRawTransaction(tx, 1, SignType.ALL).then(unlockscript => {\n        tx.inputs[1].script = unlockscript;\n        return tx;\n      })\n    })\n  }\n\n\n  static async sendRawTx(rawTx: string): Promise<string> {\n    return web3.wallet.sendRawTransaction(rawTx);\n  }\n\n  static async sendTx(tx: Tx): Promise<string> {\n    return web3.wallet.sendRawTransaction(toRawTx(tx));\n  }\n\n\n  static async deploy(contract: AbstractContract, amountInContract: number, alicePrivateKey: string, bobPrivateKey: string): Promise<[Tx, string]> {\n    return web3.buildDeployTx(contract, amountInContract, alicePrivateKey, bobPrivateKey).then(async tx => {\n      return web3.sendTx(tx).then(txid => {\n        return [tx, txid];\n      })\n    });\n  }\n}"],"sourceRoot":""}